<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Newton</title>
    
    <!-- Librerías -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f1f5f9; user-select: none; }
        
        .canvas-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, #e2e8f0 1px, transparent 1px),
                              linear-gradient(to bottom, #e2e8f0 1px, transparent 1px);
        }
        
        .space-grid {
            background-size: 40px 40px;
            background-color: #0f172a;
            background-image: radial-gradient(circle, #1e293b 1px, transparent 1px);
        }
        
        /* Animaciones */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.9); }
        }
        .animate-pulse-red { animation: pulse-red 2s infinite; }
        
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        .svg-text-shadow {
            text-shadow: 1px 1px 0px #fff, -1px -1px 0px #fff, 1px -1px 0px #fff, -1px 1px 0px #fff;
            font-weight: bold; font-family: monospace; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- ICONOS ---
        const IconBase = ({ children, color = "currentColor" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">{children}</svg>
        );
        const ArrowRight = () => <IconBase><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></IconBase>;
        const Move = () => <IconBase><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 15 22 12 19 9"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></IconBase>;
        const Rocket = () => <IconBase><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></IconBase>;
        const RefreshCw = () => <IconBase><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Lightbulb = () => <IconBase><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></IconBase>;
        const Play = () => <IconBase><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
        const Pause = () => <IconBase><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></IconBase>;
        const RotateCcw = () => <IconBase><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;
        const Flame = () => <IconBase><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.1.7-2.15 1.5-2.95.5.75.5 1.25.5 1.75Z"/></IconBase>;
        const ChevronsUp = () => <IconBase><path d="m17 11-5-5-5 5"/><path d="m17 18-5-5-5 5"/></IconBase>;
        const ZoomIn = () => <IconBase><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></IconBase>;
        const ZoomOut = () => <IconBase><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></IconBase>;
        const BarChart3 = () => <IconBase><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></IconBase>;
        const Gauge = () => <IconBase><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/></IconBase>;
        const Plus = () => <IconBase><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Minus = () => <IconBase><path d="M5 12h14"/></IconBase>;

        // --- CAPSULA TEORIA ---
        const TheoryCapsule = ({ title, content, formula, isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="absolute top-16 right-4 z-50 w-80 bg-white/95 backdrop-blur border-l-4 border-yellow-400 shadow-xl p-6 rounded-r-md animate-in slide-in-from-right duration-300 text-left">
                    <div className="flex justify-between items-start mb-3">
                        <h3 className="font-bold text-slate-800 flex items-center gap-2 text-lg">
                            <span className="text-yellow-500"><Lightbulb /></span> {title}
                        </h3>
                        <button onClick={onClose} className="text-slate-400 hover:text-slate-600 font-bold p-1">✕</button>
                    </div>
                    <p className="text-sm text-slate-600 mb-4 leading-relaxed text-justify border-t pt-2 border-slate-100">{content}</p>
                    {formula && (
                        <div className="bg-slate-100 p-3 rounded text-center font-mono text-sm font-bold text-slate-700 border border-slate-200 shadow-inner">
                            {formula}
                        </div>
                    )}
                </div>
            );
        };

        // --- 1. VECTOR LAB ---
        const VectorLab = () => {
            const [mode, setMode] = useState('1d'); 
            const [showTheory, setShowTheory] = useState(false);

            // 1D
            const [f1, setF1] = useState(50);
            const [f2, setF2] = useState(30); 
            const [f3, setF3] = useState(40); 
            const [mass, setMass] = useState(20);

            // 2D
            const [v1Mag, setV1Mag] = useState(80);
            const [v1Ang, setV1Ang] = useState(0); 
            const [v2Mag, setV2Mag] = useState(60);
            const [v2Ang, setV2Ang] = useState(90); 

            const svgRef = useRef(null);
            const draggingRef = useRef(null);

            // Cálculos 1D
            const result1D = (f1 + f2) - f3;
            const weight = mass * 9.8;
            const normal = weight; 
            const vScale = Math.min(weight / 5, 120);

            // Cálculos 2D
            const rad = (deg) => deg * (Math.PI / 180);
            const deg = (rad) => rad * (180 / Math.PI);
            
            const v1x = v1Mag * Math.cos(rad(v1Ang));
            const v1y = v1Mag * Math.sin(rad(v1Ang)); 
            const v2x = v2Mag * Math.cos(rad(v2Ang));
            const v2y = v2Mag * Math.sin(rad(v2Ang));
            
            const rx = v1x + v2x;
            const ry = v1y + v2y;
            const rMag = Math.sqrt(rx*rx + ry*ry);
            let rAng = deg(Math.atan2(ry, rx));
            if (rAng < 0) rAng += 360;

            const handleMouseDown = (vector) => { draggingRef.current = vector; };
            const handleMouseMove = (e) => {
                if (!draggingRef.current || !svgRef.current) return;
                const rect = svgRef.current.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                const dx = mouseX - 300;
                const dy = -(mouseY - 200); 
                let newAngle = deg(Math.atan2(dy, dx));
                if (newAngle < 0) newAngle += 360;
                const newMag = Math.min(Math.sqrt(dx*dx + dy*dy) / 2, 120); 
                if (draggingRef.current === 'v1') { setV1Ang(newAngle); setV1Mag(newMag); } 
                else if (draggingRef.current === 'v2') { setV2Ang(newAngle); setV2Mag(newMag); }
            };
            const handleMouseUp = () => { draggingRef.current = null; };

            return (
                <div className="flex flex-col h-full relative overflow-hidden" onMouseMove={handleMouseMove} onMouseUp={handleMouseUp}>
                    <TheoryCapsule 
                        isOpen={showTheory} onClose={() => setShowTheory(false)}
                        title={mode === '1d' ? "Suma y Resta (1D)" : "Suma Vectorial (2D)"}
                        content={mode === '1d' 
                            ? "Si van al mismo lado, se suman. Si van en contra, se restan. El Peso y la Normal se anulan en vertical." 
                            : "Arrastra los círculos en las puntas de las flechas para cambiar su dirección y fuerza. La Resultante (Verde) es la diagonal del paralelogramo."}
                        formula={mode === '1d' ? "R = (F1 + F2) - F3" : "R² = F1² + F2² + 2·F1·F2·cos(α)"}
                    />

                    <div className="bg-white p-4 border-b flex justify-between items-center shadow-sm z-20">
                        <div className="flex items-center gap-4">
                            <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><span className="text-blue-600 flex shrink-0"><ArrowRight /></span> 1. Laboratorio de Vectores</h2>
                            <div className="bg-slate-100 p-1 rounded-lg flex gap-1">
                                <button onClick={() => setMode('1d')} className={`px-3 py-1 rounded text-sm font-bold transition-colors ${mode === '1d' ? 'bg-white text-blue-600 shadow' : 'text-slate-500 hover:text-slate-700'}`}>1D: Lineal</button>
                                <button onClick={() => setMode('2d')} className={`px-3 py-1 rounded text-sm font-bold transition-colors ${mode === '2d' ? 'bg-white text-purple-600 shadow' : 'text-slate-500 hover:text-slate-700'}`}>2D: Libre</button>
                            </div>
                        </div>
                        <button onClick={() => setShowTheory(!showTheory)} className="p-2 bg-yellow-100 text-yellow-700 rounded-full hover:bg-yellow-200 transition"><Lightbulb /></button>
                    </div>

                    <div className="flex-1 relative flex flex-col items-center justify-center bg-slate-50 canvas-grid">
                        
                        {mode === '1d' ? (
                            /* MODO 1D */
                            <div className="relative w-full h-full flex items-center justify-center">
                                <div className="absolute w-full h-1/2 bottom-0 border-t border-slate-400"></div>
                                <div className="w-28 h-28 bg-slate-800 rounded flex flex-col items-center justify-center shadow-xl z-10 relative">
                                    <span className="text-white font-bold text-xl">{mass} kg</span>
                                    <span className="text-slate-400 text-xs">Objeto</span>
                                    
                                    {/* NORMALE (AMB FLECHA) */}
                                    <div className="absolute bottom-full left-1/2 w-2 bg-yellow-400 flex justify-center transition-all duration-300 origin-bottom" style={{ height: `${vScale}px`, transform: 'translateX(-50%)' }}>
                                        <div className="absolute top-0 w-0 h-0 border-b-[12px] border-b-yellow-400 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent -translate-y-full"></div>
                                        <span className="absolute -top-8 bg-white/80 px-1 rounded text-xs font-bold text-yellow-600 whitespace-nowrap border border-yellow-200">N = {weight.toFixed(0)}N</span>
                                    </div>
                                    
                                    {/* PESO (AMB FLECHA - COLOR LILA) */}
                                    <div className="absolute top-full left-1/2 w-2 bg-purple-500 flex justify-center transition-all duration-300 origin-top" style={{ height: `${vScale}px`, transform: 'translateX(-50%)' }}>
                                        <div className="absolute bottom-0 w-0 h-0 border-t-[12px] border-t-purple-500 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent translate-y-full"></div>
                                        <span className="absolute -bottom-8 bg-white/80 px-1 rounded text-xs font-bold text-purple-700 whitespace-nowrap border border-purple-200">P = {weight.toFixed(0)}N</span>
                                    </div>
                                </div>

                                {/* F1 (AMB FLECHA) */}
                                <div className="absolute h-4 bg-blue-500 flex items-center justify-end pr-4 text-white font-bold text-xs transition-all duration-300 z-10" style={{ left: 'calc(50% + 56px)', width: `${f1 * 2}px`, top: 'calc(50% - 20px)' }}>
                                    <span className="mr-1">F1</span>
                                    <div className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-[8px] w-0 h-0 border-l-[12px] border-l-blue-500 border-y-[6px] border-y-transparent"></div>
                                </div>

                                {/* F2 (AMB FLECHA) */}
                                <div className="absolute h-4 bg-blue-300 flex items-center justify-end pr-4 text-blue-900 font-bold text-xs transition-all duration-300" style={{ left: `calc(50% + 56px + ${f1 * 2}px)`, width: `${f2 * 2}px`, top: 'calc(50% - 20px)' }}>
                                    <span className="mr-1">F2</span>
                                    <div className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-[8px] w-0 h-0 border-l-[12px] border-l-blue-300 border-y-[6px] border-y-transparent"></div>
                                </div>

                                {/* F3 (AMB FLECHA - ESQUERRA) */}
                                <div className="absolute h-4 bg-red-500 flex items-center justify-start pl-4 text-white font-bold text-xs transition-all duration-300" style={{ right: 'calc(50% + 56px)', width: `${f3 * 2}px`, top: 'calc(50% - 20px)' }}>
                                    <span className="ml-1">F3</span>
                                    <div className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-[8px] w-0 h-0 border-r-[12px] border-r-red-500 border-y-[6px] border-y-transparent"></div>
                                </div>

                                {/* RESULTANT (AMB FLECHA) */}
                                <div className="absolute h-6 bg-green-600 flex items-center justify-center text-white font-bold text-sm border-2 border-green-800 shadow-lg transition-all duration-300 z-20" style={{ left: '50%', width: `${Math.abs(result1D) * 2}px`, top: 'calc(50% + 40px)', transform: result1D < 0 ? 'translateX(-100%)' : 'none', opacity: result1D === 0 ? 0 : 1 }}>
                                    R = {Math.abs(result1D)} N
                                    {result1D > 0 ? (
                                        <div className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-[8px] w-0 h-0 border-l-[12px] border-l-green-600 border-y-[6px] border-y-transparent"></div>
                                    ) : (
                                        <div className="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-[8px] w-0 h-0 border-r-[12px] border-r-green-600 border-y-[6px] border-y-transparent"></div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            /* MODO 2D LIBRE */
                            <div className="relative w-full h-full flex items-center justify-center">
                                <svg ref={svgRef} width="600" height="400" className="overflow-visible bg-white/50 border border-slate-200 rounded shadow-inner cursor-crosshair">
                                    <defs>
                                        <marker id="head-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#2563eb" /></marker>
                                        <marker id="head-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" /></marker>
                                        <marker id="head-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#16a34a" /></marker>
                                    </defs>
                                    <line x1="300" y1="20" x2="300" y2="380" stroke="#cbd5e1" strokeWidth="2" />
                                    <line x1="20" y1="200" x2="580" y2="200" stroke="#cbd5e1" strokeWidth="2" />
                                    {/* F1 */}
                                    <line x1="300" y1="200" x2={300 + v1x * 2} y2={200 - v1y * 2} stroke="#2563eb" strokeWidth="4" markerEnd="url(#head-blue)" />
                                    <text x={300 + v1x * 2 + 10} y={200 - v1y * 2 - 10} fill="#2563eb" className="svg-text-shadow">{v1Mag.toFixed(0)}N</text>
                                    <circle cx={300 + v1x * 2} cy={200 - v1y * 2} r="8" fill="white" stroke="#2563eb" strokeWidth="2" className="cursor-grab hover:fill-blue-100" onMouseDown={() => handleMouseDown('v1')}/>
                                    {/* F2 */}
                                    <line x1="300" y1="200" x2={300 + v2x * 2} y2={200 - v2y * 2} stroke="#ef4444" strokeWidth="4" markerEnd="url(#head-red)" />
                                    <text x={300 + v2x * 2 + 10} y={200 - v2y * 2 - 10} fill="#ef4444" className="svg-text-shadow">{v2Mag.toFixed(0)}N</text>
                                    <circle cx={300 + v2x * 2} cy={200 - v2y * 2} r="8" fill="white" stroke="#ef4444" strokeWidth="2" className="cursor-grab hover:fill-red-100" onMouseDown={() => handleMouseDown('v2')}/>
                                    {/* Parallelogramo */}
                                    <line x1={300 + v1x * 2} y1={200 - v1y * 2} x2={300 + rx * 2} y2={200 - ry * 2} stroke="#94a3b8" strokeWidth="2" strokeDasharray="5,5" />
                                    <line x1={300 + v2x * 2} y1={200 - v2y * 2} x2={300 + rx * 2} y2={200 - ry * 2} stroke="#94a3b8" strokeWidth="2" strokeDasharray="5,5" />
                                    {/* R */}
                                    <line x1="300" y1="200" x2={300 + rx * 2} y2={200 - ry * 2} stroke="#16a34a" strokeWidth="5" markerEnd="url(#head-green)" />
                                    <text x={300 + rx * 2 + 10} y={200 - ry * 2 - 10} fill="#16a34a" className="svg-text-shadow text-lg">{rMag.toFixed(0)}N</text>
                                </svg>
                                <div className="absolute bottom-4 left-4 bg-white/90 p-2 rounded shadow border text-xs pointer-events-none">
                                    Arrastra los círculos para cambiar los vectores
                                </div>
                            </div>
                        )}
                    </div>
                    {/* Controles */}
                    <div className="bg-white p-6 border-t grid grid-cols-1 md:grid-cols-3 gap-8 shadow-up z-20">
                        {mode === '1d' ? (
                            <>
                                <div className="space-y-2">
                                    <div className="bg-blue-50 p-2 rounded border border-blue-100">
                                        <div className="flex gap-2 items-center mb-1"><span className="text-xs w-4 font-bold text-blue-700">F1</span><input type="range" min="0" max="100" value={f1} onChange={(e) => setF1(parseInt(e.target.value))} className="w-full h-2 bg-blue-200 rounded accent-blue-600" /></div>
                                        <div className="flex gap-2 items-center"><span className="text-xs w-4 font-bold text-blue-700">F2</span><input type="range" min="0" max="100" value={f2} onChange={(e) => setF2(parseInt(e.target.value))} className="w-full h-2 bg-blue-200 rounded accent-blue-400" /></div>
                                    </div>
                                    <div className="bg-red-50 p-2 rounded border border-red-100">
                                        <div className="flex gap-2 items-center"><span className="text-xs w-4 font-bold text-red-700">F3</span><input type="range" min="0" max="100" value={f3} onChange={(e) => setF3(parseInt(e.target.value))} className="w-full h-2 bg-red-200 rounded accent-red-600" /></div>
                                    </div>
                                </div>
                                <div className="space-y-2 flex flex-col justify-center">
                                    <label className="text-sm font-bold text-slate-700 flex justify-between"><span>Masa del Objeto</span><span>{mass} kg</span></label>
                                    <input type="range" min="10" max="100" value={mass} onChange={(e) => setMass(parseInt(e.target.value))} className="w-full h-2 bg-slate-300 rounded accent-slate-600" />
                                    <p className="text-xs text-slate-500 text-center mt-1">Afecta a Peso (P) y Normal (N)</p>
                                </div>
                                <div className="bg-slate-100 p-3 rounded border border-slate-200 font-mono text-sm flex flex-col justify-center">
                                    <p className="mb-1 font-bold text-slate-500">Horizontal:</p>
                                    <p className="mb-1">R = ({f1} + {f2}) - {f3}</p>
                                    <p className="font-bold text-green-600 text-lg bg-white p-1 rounded border border-green-200 text-center mb-2">R = {result1D} N</p>
                                    <p className="font-bold text-slate-500 border-t border-slate-300 pt-1">Vertical:</p>
                                    <p className="text-xs">N - P = {weight.toFixed(0)} - {weight.toFixed(0)} = 0</p>
                                </div>
                            </>
                        ) : (
                            <>
                                <div className="space-y-3 bg-blue-50 p-3 rounded border border-blue-100">
                                    <p className="text-xs font-bold text-blue-700 mb-1">Fuerza 1 (Azul)</p>
                                    <div className="flex gap-2 items-center"><span className="text-xs w-12">Módulo</span><input type="range" min="0" max="100" value={v1Mag} onChange={(e) => setV1Mag(parseInt(e.target.value))} className="w-full h-2 bg-blue-200 rounded accent-blue-600" /></div>
                                    <div className="flex gap-2 items-center"><span className="text-xs w-12">Ángulo</span><input type="range" min="0" max="360" value={v1Ang} onChange={(e) => setV1Ang(parseInt(e.target.value))} className="w-full h-2 bg-blue-200 rounded accent-blue-400" /></div>
                                </div>
                                <div className="space-y-3 bg-red-50 p-3 rounded border border-red-100">
                                    <p className="text-xs font-bold text-red-700 mb-1">Fuerza 2 (Roja)</p>
                                    <div className="flex gap-2 items-center"><span className="text-xs w-12">Módulo</span><input type="range" min="0" max="100" value={v2Mag} onChange={(e) => setV2Mag(parseInt(e.target.value))} className="w-full h-2 bg-red-200 rounded accent-red-600" /></div>
                                    <div className="flex gap-2 items-center"><span className="text-xs w-12">Ángulo</span><input type="range" min="0" max="360" value={v2Ang} onChange={(e) => setV2Ang(parseInt(e.target.value))} className="w-full h-2 bg-red-200 rounded accent-red-400" /></div>
                                </div>
                                <div className="bg-slate-100 p-3 rounded border border-slate-200 font-mono text-sm flex flex-col justify-center items-center">
                                    <p className="text-xs text-slate-500 mb-1">RESULTANTE (Verde)</p>
                                    <p className="font-bold text-green-600 text-2xl">R = {rMag.toFixed(1)} N</p>
                                    <p className="text-xs text-slate-600">Ángulo: {rAng.toFixed(0)}°</p>
                                    <div className="text-[10px] text-slate-400 mt-2 text-left w-full">
                                        Rx = {(v1x+v2x).toFixed(0)}, Ry = {(v1y+v2y).toFixed(0)}
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // --- 2. MOTION LAB ---
        const MotionLab = () => {
            const [force, setForce] = useState(0);
            const [mass, setMass] = useState(1000);
            const [surface, setSurface] = useState(0.05); 
            const [showTheory, setShowTheory] = useState(false);
            const state = useRef({ pos: 50, vel: 0, acc: 0, t: 0 });
            const [visual, setVisual] = useState({ ...state.current });
            const [graphData, setGraphData] = useState([]);
            const reqRef = useRef();
            const lastUpdateRef = useRef(0);

            useEffect(() => { setGraphData([]); state.current.t = 0; }, [mass, surface]);

            useEffect(() => {
                const loop = (time) => {
                    const normal = mass * 9.8;
                    let frictionForce = 0;
                    if (Math.abs(state.current.vel) > 0.1) {
                        frictionForce = (state.current.vel > 0 ? -1 : 1) * (surface * normal);
                    } else {
                        const maxStatic = surface * normal;
                        if (Math.abs(force) <= maxStatic) frictionForce = -force;
                        else frictionForce = (force > 0 ? -1 : 1) * (surface * normal);
                    }
                    const netForce = force + frictionForce;
                    const acc = netForce / mass;
                    const dt = 0.03;
                    state.current.vel += acc * dt;
                    state.current.pos += state.current.vel * dt * 5;
                    state.current.acc = acc;
                    state.current.t += dt;
                    if (Math.abs(state.current.vel) < 0.1 && Math.abs(netForce) < 1) { state.current.vel = 0; state.current.acc = 0; }
                    if (state.current.pos > 1000) state.current.pos = -200;
                    if (state.current.pos < -200) state.current.pos = 1000;
                    if (time - lastUpdateRef.current > 50) {
                        setVisual({ ...state.current });
                        setGraphData(prev => { const d = [...prev, { t: state.current.t, v: state.current.vel }]; return d.slice(-50); });
                        lastUpdateRef.current = time;
                    }
                    reqRef.current = requestAnimationFrame(loop);
                };
                reqRef.current = requestAnimationFrame(loop);
                return () => cancelAnimationFrame(reqRef.current);
            }, [force, mass, surface]);

            return (
                <div className="flex flex-col h-full relative">
                     <TheoryCapsule isOpen={showTheory} onClose={() => setShowTheory(false)} title="2ª Ley de Newton" content="Aquí mandas tú. Fíjate que en 'Arena' (0.9) cuesta mucho arrancar, pero en 'Hielo' (0.0) el coche desliza. La masa también importa: ¡Un camión de 5000kg en arena es casi inamovible!" formula="a = (F_motor - F_roz) / m" />
                    <div className="bg-white p-4 border-b flex justify-between items-center">
                         <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><span className="text-orange-500 flex shrink-0"><Move /></span> 2. Dinámica del Vehículo</h2>
                        <button onClick={() => setShowTheory(!showTheory)} className="p-2 bg-yellow-100 text-yellow-700 rounded-full hover:bg-yellow-200 transition"><Lightbulb /></button>
                    </div>
                    <div className="flex-1 relative bg-slate-200 overflow-hidden flex flex-col justify-center">
                        <div className="absolute top-4 right-4 w-64 h-40 bg-black/90 rounded-lg border-2 border-slate-600 p-2 shadow-xl z-10 font-mono">
                            <div className="text-green-400 text-xs mb-1 flex justify-between"><span>VELOCIDAD (v)</span><span>{visual.vel.toFixed(1)} m/s</span></div>
                            <div className="relative h-full w-full border-l border-b border-green-900 overflow-hidden">
                                <svg className="w-full h-full" preserveAspectRatio="none">
                                    <path d={`M ${graphData.map((p, i) => `${(i/50)*100} ${50 - (p.v * 1.5)}`).join(' L ')}`} fill="none" stroke="#4ade80" strokeWidth="2" />
                                </svg>
                            </div>
                        </div>
                        <div className="absolute w-full h-40 bg-gray-700 border-y-8 border-gray-800 flex items-center overflow-hidden">
                            <div className="w-full h-0 border-t-4 border-dashed border-white/30"></div>
                            <div className="absolute inset-0 opacity-20 pointer-events-none" style={{ backgroundImage: surface > 0.5 ? 'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzhhYWGMYAEYB8RmROaABADeOQ8CXl/xfgAAAABJRU5ErkJggg==")' : 'none', backgroundSize: '4px 4px' }}></div>
                        </div>
                        <div style={{ transform: `translateX(${visual.pos}px)` }} className="absolute z-10 transition-transform duration-75 ease-linear will-change-transform mb-4">
                             <div className="relative w-40 h-20">
                                <div className="absolute top-0 left-0 w-full h-14 bg-orange-500 rounded-lg shadow-lg border-2 border-orange-700 flex items-center justify-center z-10"><span className="text-white font-black text-lg">{mass} kg</span></div>
                                <div className={`absolute -bottom-4 left-4 w-12 h-12 bg-slate-900 rounded-full border-4 border-slate-600 flex items-center justify-center ${visual.vel !== 0 ? 'animate-spin' : ''}`} style={{ animationDuration: visual.vel !== 0 ? `${20/Math.abs(visual.vel)}s` : '0s' }}><div className="w-1 h-full bg-slate-500"></div><div className="h-1 w-full bg-slate-500"></div></div>
                                <div className={`absolute -bottom-4 right-4 w-12 h-12 bg-slate-900 rounded-full border-4 border-slate-600 flex items-center justify-center ${visual.vel !== 0 ? 'animate-spin' : ''}`} style={{ animationDuration: visual.vel !== 0 ? `${20/Math.abs(visual.vel)}s` : '0s' }}><div className="w-1 h-full bg-slate-500"></div><div className="h-1 w-full bg-slate-500"></div></div>
                                {force !== 0 && <div className="absolute top-1/2 right-0 translate-x-1/2 -translate-y-full h-4 bg-blue-600 origin-left flex items-center z-20 opacity-90 shadow-sm" style={{ width: `${Math.abs(force)/50}px`, transform: force < 0 ? 'translateX(-100%) rotate(180deg)' : '' }}><div className="absolute right-[-8px] w-0 h-0 border-l-[12px] border-l-blue-600 border-y-[6px] border-y-transparent"></div></div>}
                             </div>
                        </div>
                    </div>
                     <div className="bg-slate-50 p-4 border-t grid grid-cols-1 md:grid-cols-3 gap-6 z-20 shadow-lg">
                        <div className="space-y-1">
                            <label className="text-sm font-bold text-slate-700 flex justify-between"><span>Motor</span><span className={force > 0 ? 'text-green-600' : 'text-slate-400'}>{force} N</span></label>
                            <input type="range" min="-10000" max="10000" step="100" value={force} onChange={(e) => setForce(parseInt(e.target.value))} className="w-full h-3 bg-slate-300 rounded-lg accent-orange-600" />
                        </div>
                        <div className="space-y-4">
                             <div className="flex flex-col gap-1">
                                <label className="text-xs font-bold text-slate-600 flex justify-between"><span>Masa</span><span>{mass} kg</span></label>
                                <input type="range" min="500" max="5000" step="100" value={mass} onChange={(e) => setMass(parseInt(e.target.value))} className="w-full h-1 bg-slate-300 rounded accent-slate-600" />
                             </div>
                             <div className="flex flex-col gap-1">
                                <label className="text-xs font-bold text-slate-600 flex justify-between"><span>Superficie (Rozamiento)</span><span>{surface.toFixed(2)}</span></label>
                                <input type="range" min="0" max="1.0" step="0.1" value={surface} onChange={(e) => setSurface(parseFloat(e.target.value))} className="w-full h-1 bg-slate-300 rounded accent-slate-600" />
                                <div className="flex justify-between text-[10px] text-slate-500 font-bold uppercase tracking-wider px-1">
                                    <span>Hielo</span>
                                    <span>Asfalto</span>
                                    <span>Arena</span>
                                </div>
                             </div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 text-center bg-white rounded-lg p-2 border border-slate-200">
                            <div className="flex flex-col justify-center"><div className="text-[10px] text-slate-500">ACELERACIÓN</div><div className={`text-lg font-mono font-bold ${visual.acc > 0 ? 'text-purple-600' : 'text-slate-700'}`}>{visual.acc.toFixed(2)} <span className="text-xs">m/s²</span></div></div>
                            <div className="flex flex-col justify-center border-l"><div className="text-[10px] text-slate-500">FRICCIÓN</div><div className="text-lg font-mono font-bold text-red-500">{Math.abs((Math.abs(visual.vel) > 0.1 || Math.abs(force) > surface * mass * 9.8) ? surface * mass * 9.8 : force).toFixed(0)} <span className="text-xs">N</span></div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. SPRING LAB ---
        const SpringLab = () => {
            const [k, setK] = useState(20);
            const [mass, setMass] = useState(2); 
            const [showTheory, setShowTheory] = useState(false);
            const physics = useRef({ x: 0, v: 0 });
            const [visualX, setVisualX] = useState(0);
            const reqRef = useRef();
            const isDraggingRef = useRef(false);

            useEffect(() => {
                const loop = () => {
                    if (!isDraggingRef.current) {
                        const c = 0.5; const force = -k * physics.current.x - c * physics.current.v; const acc = force / mass;
                        physics.current.v += acc * 0.05; physics.current.x += physics.current.v * 0.05;
                        if (Math.abs(physics.current.v) < 0.005 && Math.abs(physics.current.x) < 0.1) { physics.current.v = 0; physics.current.x *= 0.95; }
                    }
                    setVisualX(physics.current.x); reqRef.current = requestAnimationFrame(loop);
                };
                reqRef.current = requestAnimationFrame(loop);
                return () => cancelAnimationFrame(reqRef.current);
            }, [k, mass]);

            const handleMouseDown = () => { isDraggingRef.current = true; };
            const handleMouseUp = () => { isDraggingRef.current = false; };
            const handlePull = (val) => { physics.current.x = parseInt(val); physics.current.v = 0; setVisualX(parseInt(val)); };

            const generateSpringPath = (displacement) => {
                const coils = 12; const width = 200 + displacement * 2; let d = `M 0 30 `; const step = width / coils;
                for(let i=0; i<coils; i++) d += `L ${step*(i+0.25)} 10 L ${step*(i+0.75)} 50 `;
                d += `L ${width} 30`; return d;
            }
            const springForce = -k * visualX;
            const blockSize = mass === 2 ? 16 : mass === 5 ? 20 : mass === 10 ? 24 : 32;

            return (
                <div className="flex flex-col h-full relative" onMouseUp={handleMouseUp}>
                     <TheoryCapsule isOpen={showTheory} onClose={() => setShowTheory(false)} title="Inercia" content="La masa de 50kg tiene mucha INERCIA. Cuesta más frenarla." formula="Inercia ~ Masa" />
                    <div className="bg-white p-4 border-b flex justify-between items-center">
                        <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><span className="text-teal-500 flex shrink-0"><RefreshCw /></span> 3. Ley de Hooke</h2>
                        <button onClick={() => setShowTheory(!showTheory)} className="p-2 bg-yellow-100 text-yellow-700 rounded-full hover:bg-yellow-200 transition"><Lightbulb /></button>
                    </div>
                    <div className="flex-1 bg-slate-50 flex flex-col items-center justify-center relative overflow-hidden canvas-grid">
                        <div className="flex items-center w-full px-10">
                            <div className="w-8 h-48 bg-slate-700 rounded-sm shadow-xl z-10"></div>
                            <div className="relative">
                                <svg width={Math.max(200 + visualX * 2 + 50, 50)} height="80" className="overflow-visible">
                                    <path d={generateSpringPath(visualX)} stroke="#0d9488" strokeWidth="6" fill="none" strokeLinecap="round" strokeLinejoin="round" />
                                </svg>
                                {Math.abs(springForce) > 5 && (
                                     <div className="absolute top-[-20px] left-1/2 w-0 h-0" style={{ left: `${(200+visualX*2)/2}px` }}>
                                         <div className="absolute h-2 bg-red-500 origin-left flex items-center opacity-80" style={{ width: `${Math.abs(springForce)}px`, transform: springForce > 0 ? '' : 'rotate(180deg)' }}>
                                            <div className="absolute right-[-8px] w-0 h-0 border-l-[12px] border-l-red-500 border-y-[6px] border-y-transparent"></div>
                                         </div>
                                     </div>
                                )}
                            </div>
                            <div className="bg-teal-600 rounded-lg shadow-lg flex items-center justify-center z-10 relative border-4 border-teal-800 transition-all duration-300" style={{ width: `${blockSize*4}px`, height: `${blockSize*4}px` }}>
                                <span className="text-white font-bold">{mass} kg</span>
                            </div>
                        </div>
                        <div className="absolute top-0 bottom-0 left-[250px] border-l-2 border-dashed border-slate-300 pointer-events-none"></div>
                    </div>
                    <div className="bg-white p-6 border-t grid grid-cols-1 md:grid-cols-3 gap-6 z-20 shadow-lg">
                        <div className="space-y-2">
                            <label className="text-sm font-bold text-slate-700">Masa del Objeto</label>
                            <select value={mass} onChange={(e) => setMass(parseInt(e.target.value))} className="w-full p-2 bg-slate-100 border border-slate-300 rounded-lg font-bold text-slate-700 focus:ring-2 focus:ring-teal-500">
                                <option value="2">2 kg (Ligero)</option>
                                <option value="5">5 kg (Medio)</option>
                                <option value="10">10 kg (Pesado)</option>
                                <option value="50">50 kg (Tren de Mercancías)</option>
                            </select>
                        </div>
                        <div className="space-y-2">
                            <label className="text-sm font-bold text-slate-700">Posición (Arrastrar)</label>
                            <input type="range" min="-80" max="150" 
                                onMouseDown={handleMouseDown} 
                                onChange={(e) => handlePull(e.target.value)} 
                                onMouseUp={handleMouseUp} 
                                className="w-full cursor-grab active:cursor-grabbing accent-teal-600" />
                        </div>
                        <div className="bg-slate-50 p-2 rounded border border-slate-200 text-xs font-mono text-center flex flex-col justify-center">
                            <p className="text-lg font-bold text-slate-800">{springForce.toFixed(0)} N</p>
                            <p className="text-slate-400">Fuerza Restauradora</p>
                        </div>
                    </div>
                </div>
            )
        }

        // --- 4. SPACE LAB ---
        const SpaceLab = () => {
            const [showTheory, setShowTheory] = useState(false);
            const canvasRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [initVx, setInitVx] = useState(1.5); 
            const [initY, setInitY] = useState(150);
            const [initX, setInitX] = useState(50); 
            const [zoom, setZoom] = useState(1.0); 
            const [gameState, setGameState] = useState('ready');
            const [feedbackMsg, setFeedbackMsg] = useState(null);
            const [minComputer, setMinComputer] = useState(false);
            const [minTelemetry, setMinTelemetry] = useState(false);
            const [planetMass, setPlanetMass] = useState(8000);

            const simState = useRef({
                asteroid: { x: 20, y: 150, vx: 0, vy: 0, mass: 10, angle: 0 },
                planet: { x: 600, y: 400, mass: 8000, radius: 30 }, 
                target: { x: 1100, y: 400, radius: 20 }, 
                trail: []
            });

            const [telemetry, setTelemetry] = useState({ dist: 0, force: 0, speed: 0, angle: 0, ke: 0, pe: 0 });
            const lastUpdateRef = useRef(0);

            const resetSim = useCallback(() => {
                simState.current.asteroid = { x: initX, y: initY, vx: initVx, vy: 0, mass: 10, angle: 0 }; 
                simState.current.planet = { x: 600, y: 400, mass: planetMass, radius: 30 };
                simState.current.target = { x: 1100, y: 400, radius: 20 };
                simState.current.trail = [];
                setIsPlaying(false); setGameState('ready'); draw();
                setTelemetry({ dist: 0, force: 0, speed: 0, angle: 0, ke: 0, pe: 0 });
            }, [initVx, initY, initX, planetMass]);

            useEffect(() => { if(!isPlaying) resetSim(); }, [initVx, initY, initX, planetMass, resetSim]);

            const showFeedback = (text, type) => { setFeedbackMsg({ text, type }); setTimeout(() => setFeedbackMsg(null), 800); }
            
            const fireThrusterBrake = () => {
                if (!isPlaying) return; 
                const ast = simState.current.asteroid; 
                ast.vx *= 0.80; ast.vy *= 0.80; 
                showFeedback("¡FRENANDO -20%!", "text-red-400");
            };
            const fireThrusterAccel = () => {
                if (!isPlaying) return; 
                const ast = simState.current.asteroid; 
                ast.vx *= 1.20; ast.vy *= 1.20; 
                showFeedback("¡IMPULSO +20%!", "text-blue-400");
            };

            const updatePhysics = (time) => {
                const { asteroid, planet, target } = simState.current;
                const dx = planet.x - asteroid.x; const dy = planet.y - asteroid.y;
                const distSq = dx*dx + dy*dy; const dist = Math.sqrt(distSq);
                const dxT = target.x - asteroid.x; const dyT = target.y - asteroid.y; const distTarget = Math.sqrt(dxT*dxT + dyT*dyT);

                if (dist < planet.radius + 5) { setIsPlaying(false); setGameState('crash'); return; }
                if (distTarget < target.radius + 20) { setIsPlaying(false); setGameState('win'); return; }
                if (asteroid.x > 1300 || asteroid.y > 900 || asteroid.y < -100) { setIsPlaying(false); setGameState('lost'); return; }

                const G = 2; const forceMag = (G * asteroid.mass * planet.mass) / distSq;
                const speed = Math.sqrt(asteroid.vx**2 + asteroid.vy**2);
                
                if (time - lastUpdateRef.current > 100) {
                    const velAngle = Math.atan2(asteroid.vy, asteroid.vx); const gravAngle = Math.atan2(dy, dx);
                    let angleDiff = Math.abs(velAngle - gravAngle) * (180/Math.PI); if (angleDiff > 180) angleDiff = 360 - angleDiff; 
                    const Ke = 0.5 * asteroid.mass * speed * speed; const Pe = (10000 / dist); 
                    setTelemetry({ dist, force: forceMag, speed, angle: angleDiff, ke: Ke, pe: Pe });
                    lastUpdateRef.current = time;
                }

                const ax = (forceMag * (dx / dist)) / asteroid.mass; const ay = (forceMag * (dy / dist)) / asteroid.mass;
                const dt = 0.15; 
                asteroid.vx += ax * dt; asteroid.vy += ay * dt; asteroid.x += asteroid.vx * dt; asteroid.y += asteroid.vy * dt;
                if (Math.abs(asteroid.vx) > 0.01 || Math.abs(asteroid.vy) > 0.01) asteroid.angle = Math.atan2(asteroid.vy, asteroid.vx);
                simState.current.trail.push({x: asteroid.x, y: asteroid.y}); if(simState.current.trail.length > 600) simState.current.trail.shift();
            };

            const drawRocket = (ctx, x, y, angle, scale = 1) => {
                ctx.save(); ctx.translate(x, y); ctx.rotate(angle); ctx.scale(scale, scale);
                if (telemetry.speed > 1.0) { ctx.beginPath(); ctx.fillStyle = '#f59e0b'; ctx.moveTo(-15, -5); ctx.lineTo(-25 - Math.random()*5, 0); ctx.lineTo(-15, 5); ctx.fill(); }
                ctx.beginPath(); ctx.fillStyle = '#e2e8f0'; ctx.ellipse(0, 0, 15, 6, 0, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); ctx.fillStyle = '#ef4444'; ctx.moveTo(-8, -6); ctx.lineTo(-15, -12); ctx.lineTo(-5, -4); ctx.moveTo(-8, 6); ctx.lineTo(-15, 12); ctx.lineTo(-5, 4); ctx.fill();
                ctx.beginPath(); ctx.fillStyle = '#3b82f6'; ctx.arc(5, -2, 2, 0, Math.PI * 2); ctx.fill(); ctx.restore();
            };

            const draw = () => {
                const canvas = canvasRef.current; if (!canvas) return; const ctx = canvas.getContext('2d');
                const { asteroid, planet, target, trail } = simState.current;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save(); ctx.translate(600, 400); ctx.scale(zoom, zoom); ctx.translate(-600, -400);

                ctx.beginPath(); ctx.strokeStyle = 'rgba(100, 200, 255, 0.3)'; ctx.lineWidth = 2 / zoom;
                trail.forEach((p, i) => { if (i === 0) ctx.moveTo(p.x, p.y); else ctx.lineTo(p.x, p.y); }); ctx.stroke();

                const earthGlowRadius = target.radius * 4; 
                const eGrad = ctx.createRadialGradient(target.x, target.y, target.radius, target.x, target.y, earthGlowRadius);
                eGrad.addColorStop(0, 'rgba(16, 185, 129, 0.4)'); 
                eGrad.addColorStop(1, 'rgba(16, 185, 129, 0)');
                ctx.beginPath(); ctx.fillStyle = eGrad; ctx.arc(target.x, target.y, earthGlowRadius, 0, Math.PI * 2); ctx.fill();

                ctx.beginPath(); ctx.fillStyle = '#10b981'; ctx.arc(target.x, target.y, target.radius, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = 'white'; ctx.font = '14px Arial'; ctx.fillText("TIERRA", target.x - 25, target.y - 30);

                const gravityIntensity = Math.min(telemetry.force / 15, 0.6); const maxGravityRadius = 300;
                const gGrad = ctx.createRadialGradient(planet.x, planet.y, planet.radius, planet.x, planet.y, maxGravityRadius);
                gGrad.addColorStop(0, `rgba(239, 68, 68, ${gravityIntensity + 0.1})`); gGrad.addColorStop(1, 'rgba(239, 68, 68, 0)');
                ctx.beginPath(); ctx.fillStyle = gGrad; ctx.arc(planet.x, planet.y, maxGravityRadius, 0, Math.PI * 2); ctx.fill();
                ctx.beginPath(); const grad = ctx.createRadialGradient(planet.x, planet.y, 5, planet.x, planet.y, planet.radius); grad.addColorStop(0, '#60a5fa'); grad.addColorStop(1, '#1d4ed8'); ctx.fillStyle = grad; ctx.arc(planet.x, planet.y, planet.radius, 0, Math.PI * 2); ctx.fill();

                drawRocket(ctx, asteroid.x, asteroid.y, asteroid.angle, 1.5); ctx.restore();
            };

            useEffect(() => {
                let animationId; 
                const render = (time) => { 
                    if (isPlaying) updatePhysics(time); 
                    draw(); 
                    animationId = requestAnimationFrame(render); 
                };
                render(0); 
                return () => cancelAnimationFrame(animationId);
            }, [isPlaying, zoom]);

            return (
                <div className="flex flex-col h-full relative bg-slate-900 text-white">
                     <TheoryCapsule isOpen={showTheory} onClose={() => setShowTheory(false)} title="Física Orbital" content="La Energía se conserva: al caer (baja potencial), ganas velocidad (sube cinética). Al cambiar la masa del planeta, cambia la fuerza de gravedad (F = G·M·m/r²), pero mantenemos el tamaño visual constante para simular un cambio de DENSIDAD." />
                    <div className="bg-slate-800 p-4 border-b border-slate-700 flex justify-between items-center shadow-md z-20">
                        <div className="flex items-center gap-4">
                            <h2 className="text-xl font-bold flex items-center gap-2"><span className="text-purple-400 flex shrink-0"><Rocket /></span> 4. Misión Orbital</h2>
                             <div className="flex flex-col">
                                <label className="text-[10px] font-bold text-slate-400 uppercase">Masa Planeta</label>
                                <select value={planetMass} onChange={(e) => setPlanetMass(parseInt(e.target.value))} className="text-xs bg-slate-700 border border-slate-600 rounded px-2 py-1 text-white focus:outline-none focus:border-blue-500">
                                    <option value="4000">Enana (4k) - Poca Gravedad</option>
                                    <option value="8000">Estándar (8k) - Normal</option>
                                    <option value="16000">Supermasiva (16k) - ¡Peligro!</option>
                                </select>
                             </div>
                        </div>
                        <div className="flex gap-4 items-center">
                            <div className="flex items-center gap-2 bg-slate-700 px-3 py-1 rounded-full"><span className="text-slate-400"><ZoomOut size={16} /></span><input type="range" min="0.5" max="2.0" step="0.1" value={zoom} onChange={(e) => setZoom(parseFloat(e.target.value))} className="w-24 h-1 bg-slate-500 rounded appearance-none accent-blue-400" /><span className="text-slate-400"><ZoomIn size={16} /></span></div>
                            <button onClick={() => setShowTheory(!showTheory)} className="p-2 bg-yellow-600/20 text-yellow-400 rounded-full hover:bg-yellow-600/40 transition"><Lightbulb /></button>
                        </div>
                    </div>
                    <div className="flex-1 relative overflow-hidden space-grid">
                        <canvas ref={canvasRef} width={1200} height={800} className="w-full h-full block" />
                        
                        {gameState === 'crash' && <div className="absolute inset-0 flex items-center justify-center bg-red-900/50 backdrop-blur-sm"><div className="bg-red-900 p-6 rounded-xl border-2 border-red-500 text-center"><h2 className="text-3xl font-bold mb-2">💥 COLISIÓN</h2><button onClick={resetSim} className="px-4 py-2 bg-white text-red-900 font-bold rounded">Reintentar</button></div></div>}
                        {gameState === 'win' && <div className="absolute inset-0 flex items-center justify-center bg-green-900/50 backdrop-blur-sm"><div className="bg-green-900 p-6 rounded-xl border-2 border-green-500 text-center"><h2 className="text-3xl font-bold mb-2">🌍 ¡LLEGADA!</h2><button onClick={resetSim} className="px-4 py-2 bg-white text-green-900 font-bold rounded">Jugar de nuevo</button></div></div>}
                        {gameState === 'lost' && <div className="absolute inset-0 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm"><div className="bg-slate-800 p-6 rounded-xl border-2 border-slate-500 text-center"><h2 className="text-3xl font-bold mb-2">🌌 PERDIDO</h2><button onClick={resetSim} className="px-4 py-2 bg-white text-slate-900 font-bold rounded">Reintentar</button></div></div>}

                        <div className="absolute bottom-4 left-4 flex gap-2 items-end pointer-events-none">
                            <div className="w-48 bg-slate-800/90 backdrop-blur border border-slate-600 rounded-lg shadow-lg font-mono text-xs overflow-hidden pointer-events-auto">
                                <div className="flex items-center justify-between p-3 bg-slate-800 cursor-pointer hover:bg-slate-700 transition-colors" onClick={() => setMinComputer(!minComputer)}>
                                    <div className="flex items-center gap-2 text-blue-400 font-bold"><BarChart3 size={14} /> ORDENADOR</div>
                                    {minComputer ? <Plus size={14} className="text-slate-400" /> : <Minus size={14} className="text-slate-400" />}
                                </div>
                                {!minComputer && (
                                    <div className="p-3 pt-0 border-t border-slate-700">
                                        <div className="mb-3 mt-2 text-center font-bold rounded px-1 py-1 text-[10px] bg-slate-900 text-slate-300 border border-slate-700">
                                            {telemetry.angle < 90 ? "GRAVEDAD: AYUDA (Acelera)" : "GRAVEDAD: FRENA (Oposición)"}
                                        </div>
                                        <div className="grid grid-cols-2 gap-2 h-16 items-end">
                                            <div className="flex flex-col items-center gap-1 h-full justify-end">
                                                <div className="w-full bg-blue-500 transition-all duration-100" style={{ height: `${Math.min(telemetry.ke, 100)}%` }}></div>
                                                <span className="text-[9px] text-blue-300">Cinética</span>
                                            </div>
                                            <div className="flex flex-col items-center gap-1 h-full justify-end">
                                                <div className="w-full bg-yellow-500 transition-all duration-100" style={{ height: `${Math.min(telemetry.pe * 2, 100)}%` }}></div>
                                                <span className="text-[9px] text-yellow-300">Potencial</span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                            <div className="w-48 bg-slate-800/90 backdrop-blur border border-slate-600 rounded-lg shadow-lg font-mono text-xs overflow-hidden pointer-events-auto">
                                <div className="flex items-center justify-between p-3 bg-slate-800 cursor-pointer hover:bg-slate-700 transition-colors" onClick={() => setMinTelemetry(!minTelemetry)}>
                                    <div className="flex items-center gap-2 text-red-400 font-bold"><Gauge size={14} /> GRAVEDAD</div>
                                    {minTelemetry ? <Plus size={14} className="text-slate-400" /> : <Minus size={14} className="text-slate-400" />}
                                </div>
                                {!minTelemetry && (
                                    <div className="p-3 pt-0 border-t border-slate-700">
                                        <div className="mb-2 mt-2 flex justify-between text-red-400 font-bold"><span>FUERZA</span><span>{telemetry.force.toFixed(1)} N</span></div>
                                        <div className="w-full bg-slate-700 h-2 rounded mb-3 overflow-hidden"><div className="h-full bg-red-500" style={{ width: `${Math.min(telemetry.force * 2, 100)}%` }}></div></div>
                                        <div className="flex justify-between text-slate-400 mb-1"><span>Distancia</span><span>{telemetry.dist.toFixed(0)} km</span></div>
                                        <div className="flex justify-between text-slate-400"><span>Velocidad</span><span>{telemetry.speed.toFixed(2)} km/s</span></div>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="absolute bottom-8 right-8 flex flex-col items-end gap-4">
                            <div className="h-6 flex items-center justify-center w-full">
                                {feedbackMsg && <span className={`text-sm font-bold bg-slate-900/80 px-3 py-1 rounded border border-slate-500 ${feedbackMsg.type}`}>{feedbackMsg.text}</span>}
                            </div>
                            <div className="flex gap-4 justify-center w-full">
                                <button onMouseDown={fireThrusterBrake} className="w-20 h-20 rounded-full bg-red-600/80 border-4 border-red-400 shadow-[0_0_20px_rgba(220,38,38,0.5)] active:scale-95 transition-transform flex flex-col items-center justify-center gap-1 text-white font-bold text-xs hover:bg-red-500"><Flame size={20} /> FRENAR</button>
                                <button onMouseDown={fireThrusterAccel} className="w-20 h-20 rounded-full bg-blue-600/80 border-4 border-blue-400 shadow-[0_0_20px_rgba(37,99,235,0.5)] active:scale-95 transition-transform flex flex-col items-center justify-center gap-1 text-white font-bold text-xs hover:bg-blue-500"><ChevronsUp size={24} /> ACELERAR</button>
                            </div>
                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wide bg-slate-900/50 px-2 py-1 rounded w-full text-center">Haz clic repetidamente para acumular</p>
                        </div>
                    </div>
                    <div className="bg-slate-800 p-4 border-t border-slate-700 flex gap-6 items-center justify-center z-20">
                        <div className="flex items-center gap-2"><button onClick={() => setIsPlaying(!isPlaying)} className="w-12 h-12 flex items-center justify-center bg-blue-600 hover:bg-blue-500 rounded-full transition shadow-lg">{isPlaying ? <Pause size={20} /> : <Play size={20} className="ml-1" />}</button><button onClick={resetSim} className="w-10 h-10 flex items-center justify-center bg-slate-700 hover:bg-slate-600 rounded-full text-slate-300 transition"><RotateCcw size={18} /></button></div>
                        <div className="h-10 w-px bg-slate-600"></div>
                        <div className="flex gap-4">
                            <div className="flex flex-col w-24"><label className="text-[10px] font-bold text-slate-400 mb-1 uppercase">Posición X</label><input type="range" min="0" max="750" value={initX} onChange={(e) => setInitX(parseInt(e.target.value))} className="h-1 bg-slate-600 rounded appearance-none accent-blue-400" /></div>
                            <div className="flex flex-col w-24"><label className="text-[10px] font-bold text-slate-400 mb-1 uppercase">Posición Y</label><input type="range" min="0" max="800" value={initY} onChange={(e) => setInitY(parseInt(e.target.value))} className="h-1 bg-slate-600 rounded appearance-none accent-purple-500" /></div>
                            <div className="flex flex-col w-24"><label className="text-[10px] font-bold text-slate-400 mb-1 uppercase">Impulso</label><input type="range" min="0.1" max="4.0" step="0.1" value={initVx} onChange={(e) => setInitVx(parseFloat(e.target.value))} className="h-1 bg-slate-600 rounded appearance-none accent-green-500" /></div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('vectors');
            return (
                <div className="flex flex-col h-screen overflow-hidden bg-slate-100 text-slate-800 font-sans">
                    <div className="w-full bg-slate-950 text-slate-400 text-[10px] text-center py-1 font-mono uppercase tracking-widest border-b border-slate-800">
                        Creado por Marc Pérez Casals
                    </div>
                    <div className="flex flex-1 overflow-hidden">
                        <div className="w-16 md:w-20 lg:w-64 bg-slate-900 text-white flex flex-col shadow-2xl z-50">
                            <div className="p-4 md:p-6 font-bold text-xl flex items-center justify-center lg:justify-start border-b border-slate-800 bg-slate-950">
                                <div className="w-8 h-8 bg-gradient-to-tr from-blue-600 to-purple-600 rounded-lg flex items-center justify-center font-serif italic shadow-lg shadow-blue-900/20">N</div>
                                <span className="hidden lg:inline ml-3 tracking-tight">NewtonLab 22.0</span>
                            </div>
                            <nav className="flex-1 pt-6 space-y-3 px-3">
                                <NavButton id="vectors" icon={ArrowRight} label="1. Fricción" active={activeTab} set={setActiveTab} color="blue" />
                                <NavButton id="motion" icon={Move} label="2. Dinámica" active={activeTab} set={setActiveTab} color="orange" />
                                <NavButton id="spring" icon={RefreshCw} label="3. Hooke" active={activeTab} set={setActiveTab} color="teal" />
                                <NavButton id="space" icon={Rocket} label="4. Gravedad" active={activeTab} set={setActiveTab} color="purple" />
                            </nav>
                            <div className="p-4 text-xs text-slate-500 border-t border-slate-800 hidden lg:block bg-slate-950">
                                <p className="font-bold text-slate-400 mb-1">Modo Profesor</p>
                                <p>Usa el icono <span className="text-yellow-500">💡</span> para ver la teoría.</p>
                            </div>
                        </div>
                        <div className="flex-1 flex flex-col overflow-hidden relative">
                            <main className="flex-1 p-4 md:p-6 overflow-hidden">
                                <div className="h-full w-full bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden flex flex-col relative">
                                    {activeTab === 'vectors' && <VectorLab />}
                                    {activeTab === 'motion' && <MotionLab />}
                                    {activeTab === 'spring' && <SpringLab />}
                                    {activeTab === 'space' && <SpaceLab />}
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            );
        };

        const NavButton = ({ id, icon: Icon, label, active, set, color }) => {
            const isActive = active === id;
            const colorClasses = { blue: 'bg-blue-600 shadow-blue-900/50', orange: 'bg-orange-600 shadow-orange-900/50', teal: 'bg-teal-600 shadow-teal-900/50', purple: 'bg-purple-600 shadow-purple-900/50' };
            return (
                <button onClick={() => set(id)} className={`w-full flex items-center p-3 rounded-xl transition-all duration-300 group ${isActive ? `${colorClasses[color]} shadow-lg translate-x-1 text-white` : 'hover:bg-slate-800 text-slate-400 hover:text-slate-100'}`}>
                    <span className={`flex items-center justify-center shrink-0 ${isActive ? 'text-white' : `text-${color}-500 group-hover:text-white`} transition-colors`}><Icon /></span>
                    <span className="hidden lg:inline ml-3 font-medium text-sm truncate min-w-0">{label}</span>
                </button>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
