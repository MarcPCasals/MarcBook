<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Chroniques des Nutriments</title>
</div>
            <div class="text-center md:text-right text-sm">
                <p class="opacity-90">Cr√©√© par <span class="font-bold text-black border-b border-orange-300">Marc P√©rez Casals</span></p>
            </div>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuente Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: #fff7ed; color: #431407; overflow-x: hidden; }
        
        /* Animaciones */
        .card-enter { animation: slideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; opacity: 0; transform: translateY(40px) scale(0.95); }
        @keyframes slideIn { to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .tooltip-enter { animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; transform-origin: bottom center; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9) translateX(-50%); } to { opacity: 1; transform: scale(1) translateX(-50%); } }

        .modal-enter { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Efecto de puntos flotantes (¬°M√ÅS GRANDE Y CENTRADO!) */
        .floating-points { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            animation: floatPointsBig 2s ease-out forwards; 
            pointer-events: none; 
            font-weight: 900; 
            color: #fbbf24; /* Dorado */
            text-shadow: 4px 4px 0 #b45309, 0 0 20px rgba(251, 191, 36, 0.5); 
            z-index: 9999; 
            font-size: 5rem; /* Muy grande */
            white-space: nowrap;
        }
        @keyframes floatPointsBig { 
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); } 
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(0deg); }
            80% { opacity: 1; transform: translate(-50%, -100%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(0.8); } 
        }

        .locked-card { filter: blur(5px) grayscale(0.8); opacity: 0.6; pointer-events: none; user-select: none; transform: scale(0.95); transition: all 0.5s ease; }
        
        .content-html ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .content-html li { margin-bottom: 0.5rem; }
        .content-html strong { color: #ea580c; font-weight: 800; }
        .content-html img { border-radius: 1rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); margin-top: 1rem; margin-bottom: 1rem; width: 100%; object-fit: cover; border: 4px solid #fff; cursor: zoom-in; transition: transform 0.2s; }
        .content-html img:hover { transform: scale(1.02); }

        .bubbles { position: fixed; width: 100%; height: 100%; z-index: -1; top: 0; left: 0; overflow: hidden; pointer-events: none; }
        .bubble { position: absolute; bottom: -100px; border-radius: 50%; animation: floatUp infinite ease-in-out; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 0.6; } 100% { transform: translateY(-120vh) scale(1.5); opacity: 0; } }
        
        .bubble-red { background-color: rgba(252, 165, 165, 0.4); } 
        .bubble-pink { background-color: rgba(253, 164, 175, 0.4); } 
        .bubble-brown { background-color: rgba(214, 211, 209, 0.4); } 
        .bubble-orange { background-color: rgba(254, 215, 170, 0.4); } 
        
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #fff7ed; }
        ::-webkit-scrollbar-thumb { background: #fdba74; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #fb923c; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // =========================================================================
        //  GALER√çA DE IM√ÅGENES
        // =========================================================================
       const GALERIA_IMAGENES = {
            BOCA: "https://i.ibb.co/JRXsHw3y/Gla-ndulas-salivales.png",
            ESOFAGO: "https://i.ibb.co/d0VLX0V9/PER.png",
            ESTOMAGO: "https://i.ibb.co/qMvBtVS6/EST.png",
            DUODENO: "https://i.ibb.co/zV7B93DP/Anexo.png",
            INTESTINO_DELGADO: "https://i.ibb.co/jZTwtpvM/istockphoto-1644655913-612x612.jpg",
            INTESTINO_GRUESO: "https://i.ibb.co/q3VhdtRy/licensed-image.jpg",
            
            GIF_ENZIMA: "https://i.ibb.co/J8TKgQF/Tijeras.gif",
            VELLOSIDADES: "https://i.ibb.co/Df0LnT8b/pili.png",
            VELLOSIDAD_DETALLE: "https://i.ibb.co/Df0LnT8b/pili.png", // Reusada ya que es la misma URL
            FLORA_INTESTINAL: "https://i.ibb.co/wFypHrQM/microbiota.jpg"
        };

        // --- ICONOS ---
        const Settings = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const Activity = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const BookOpen = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const FlaskConical = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/></svg>;
        const Move = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 15 22 12 19 9"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>;
        const HeartPulse = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/><path d="M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27"/></svg>;
        const ChevronDown = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="m6 9 6 6 6-6"/></svg>;
        const ChevronUp = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="m18 15-6-6-6 6"/></svg>;
        const Info = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
        const Lock = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Unlock = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>;
        const ArrowRight = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;
        const Stethoscope = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M4.8 2.3A.3.3 0 0 1 5 2h14a.3.3 0 0 1 .2.3v3.4a3 3 0 0 1-3 3v0a3 3 0 0 1-3-3V2"/><path d="M12 2v10"/><path d="M11 12v3a2.5 2.5 0 0 0 2.5 2.5h.5a4.5 4.5 0 0 1 4.5 4.5v3"/><path d="M5 2v3.4a3 3 0 0 0 3 3v0a3 3 0 0 0 3-3V2"/><circle cx="12" cy="12" r="2"/><path d="M5 2h14"/></svg>;
        const ZoomIn = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>;
        const X = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const Bulb = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16.5 8 4.5 4.5 0 0 0 12 3.5 4.5 4.5 0 0 0 7.5 8c0 1.57.78 3.03 2 4 .76.76 1.23 1.52 1.41 2.5H15.09Z"/></svg>;
        const Award = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>;
        const GraduationCap = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>;
        const Medal = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15"/><path d="M11 12 5.12 2.2"/><path d="m13 12 5.88-9.8"/><path d="M8 7h8"/><circle cx="12" cy="17" r="5"/><path d="M12 18v-2h-.5"/></svg>;
        const CheckCircle = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const XCircle = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>;
        const Flag = (p) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>;

        // --- DATOS DEL TEMARIO (FRANC√âS) ---
        const STEPS = [
            {
                id: 'boca',
                title: '1. La Bouche : Le D√©but',
                subtitle: 'Ingestion et Pr√©paration',
                imgUrl: GALERIA_IMAGENES.BOCA, 
                icon: 'üçé',
                processes: [
                    { type: 'mechanical', text: 'Mastication', desc: 'Les dents incisives coupent, les canines d√©chirent et les molaires broient.' },
                    { type: 'chemical', text: 'Insalivation', desc: 'L\'amylase salivaire commence l\'hydrolyse de l\'amidon.' }
                ],
                pathology: {
                    name: 'Caries Dentaires',
                    desc: 'Destruction de l\'√©mail par les acides bact√©riens. Les bact√©ries fermentent les restes de sucre, abaissant le pH et d√©min√©ralisant la dent.'
                },
                curiosity: 'Nous produisons entre 1 et 1,5 litre de salive par jour ! C\'est suffisant pour remplir deux grandes bouteilles d\'eau chaque jour.',
                expert: {
                    title: 'D√©glutition et Amylase',
                    content: 'L\'<strong>amylase salivaire (ou ptyaline)</strong> a besoin d\'un pH neutre (environ 7) pour fonctionner. Elle est inactiv√©e lorsqu\'elle atteint l\'acide de l\'estomac. La d√©glutition comporte une phase volontaire (bouche) et deux phases involontaires (pharyng√©e et ≈ìsophagienne).',
                    quiz: {
                        q: "Quel type de muscle initie la d√©glutition dans la bouche ?",
                        opts: ["Lisse (Involontaire)", "Stri√© (Volontaire)", "Cardiaque"],
                        a: 1
                    }
                },
                details: {
                    glandulas: 'Glandes Salivaires (parotides, sous-maxillaires, sublinguales)',
                    sustancias: 'Salive (avec Amylase/Ptyaline)',
                    enzimas: 'Amylase',
                    sustrato: 'Glucides (Amidon)',
                    molecula: 'Sucres plus simples (Maltose, Glucose)',
                    producto: 'BOL ALIMENTAIRE'
                },
                content: `
                    <p>La bouche n'est pas seulement une entr√©e, c'est une <strong>usine de traitement</strong> :</p>
                    <ul>
                        <li><strong>Dents :</strong> Broient les aliments pour augmenter leur surface de contact.</li>
                        <li><strong>Langue :</strong> Organe musculaire qui m√©lange les aliments avec la salive et aide √† la d√©glutition.</li>
                        <li><strong>Salive :</strong> Contient de l'<strong>Amylase</strong> (dig√®re les glucides) et du <strong>Lysozyme</strong> (bact√©ricide qui d√©sinfecte).</li>
                    </ul>
                    <p><strong>Action Enzymatique (GIF) :</strong></p>
                    <img src="${GALERIA_IMAGENES.GIF_ENZIMA}" alt="Animation d'enzyme en action" />
                `,
                quiz: {
                    question: "Nous d√©tectons un morceau de pain (amidon) dans la bouche. Quelle enzyme devons-nous activer ?",
                    options: [
                        { text: "Pepsine", correct: false, feedback: "Incorrect. La pepsine agit dans l'estomac sur les prot√©ines." },
                        { text: "Amylase Salivaire", correct: true, feedback: "Correct ! L'amylase brise les longues cha√Ænes d'amidon." },
                        { text: "Bile", correct: false, feedback: "La bile est produite dans le foie et agit sur les graisses." }
                    ]
                }
            },
            {
                id: 'esofago',
                title: '2. L\'≈ísophage : Transport',
                subtitle: 'Le pont vers l\'estomac',
                imgUrl: GALERIA_IMAGENES.ESOFAGO,
                icon: 'ü•£',
                processes: [
                    { type: 'mechanical', text: 'P√©ristaltisme', desc: 'Contractions musculaires rythmiques.' },
                    { type: 'mechanical', text: 'D√©glutition', desc: 'Passage volontaire et involontaire du bol.' }
                ],
                pathology: {
                    name: 'Reflux Gastro-≈ìsophagien',
                    desc: 'D√©faillance du sphincter ≈ìsophagien inf√©rieur (cardia). L\'acide de l\'estomac remonte et br√ªle les parois de l\'≈ìsophage (qui n\'ont pas de protection muqueuse).'
                },
                curiosity: 'Gr√¢ce aux mouvements p√©ristaltiques (force musculaire), la nourriture arriverait √† l\'estomac m√™me si vous mangiez la t√™te en bas en faisant le poirier.',
                expert: {
                    title: 'Histologie de l\'≈ísophage',
                    content: 'Le tiers sup√©rieur de l\'≈ìsophage est un muscle stri√© (volontaire), tandis que les deux tiers inf√©rieurs sont des muscles lisses (involontaires). Le <strong>Sphincter ≈ísophagien Inf√©rieur (SOI)</strong> est une zone de haute pression qui emp√™che le reflux.',
                    quiz: {
                        q: "Quelle structure emp√™che l'acide de remonter dans l'≈ìsophage ?",
                        opts: ["L'√âpiglotte", "Le Sphincter ≈ísophagien Inf√©rieur", "Le Pylore"],
                        a: 1
                    }
                },
                details: {
                    glandulas: 'Glandes muqueuses (protection)',
                    sustancias: 'Mucus',
                    enzimas: 'Aucune (transport uniquement)',
                    sustrato: '-',
                    molecula: '-',
                    producto: 'BOL ALIMENTAIRE'
                },
                content: `
                    <p>Un tube musculaire d'environ 25 cm qui relie le pharynx √† l'estomac. Points cl√©s :</p>
                    <ul>
                        <li><strong>√âpiglotte :</strong> Valve de s√©curit√© qui se ferme lors de la d√©glutition pour emp√™cher la nourriture d'aller dans les poumons.</li>
                        <li><strong>P√©ristaltisme :</strong> Contractions musculaires "en vague" qui poussent le bol. C'est si puissant que vous pourriez manger en faisant le poirier.</li>
                        <li><strong>Cardia :</strong> Valve d'entr√©e de l'estomac qui emp√™che le retour de la nourriture.</li>
                    </ul>
                `,
                quiz: {
                    question: "Pourquoi la nourriture ne va-t-elle pas dans les poumons quand on avale ?",
                    options: [
                        { text: "Parce qu'on arr√™te de respirer", correct: false, feedback: "On arr√™te de respirer momentan√©ment, mais il faut une barri√®re physique." },
                        { text: "Gr√¢ce √† l'√âpiglotte", correct: true, feedback: "Exact ! Cette valve cartilagineuse bouche la trach√©e." },
                        { text: "Gr√¢ce √† la luette", correct: false, feedback: "La luette bouche les fosses nasales, pas les poumons." }
                    ]
                }
            },
            {
                id: 'estomago',
                title: '3. L\'Estomac : Digestion Acide',
                subtitle: 'Le r√©servoir de m√©lange',
                imgUrl: GALERIA_IMAGENES.ESTOMAGO,
                icon: 'ü•£',
                processes: [
                    { type: 'chemical', text: 'Suc Gastrique', desc: 'HCl + Pepsine.' },
                    { type: 'mechanical', text: 'Mouvements de m√©lange', desc: 'Brassage musculaire intense.' }
                ],
                pathology: {
                    name: 'Gastrite et Ulc√®res',
                    desc: 'Inflammation ou plaies dans la muqueuse de l\'estomac. Si la couche de mucus protecteur fait d√©faut, l\'acide de l\'estomac dig√®re ses propres parois.'
                },
                curiosity: 'Le rev√™tement de votre estomac se r√©g√©n√®re compl√®tement tous les quelques jours. S\'il ne le faisait pas, l\'acide le dig√©rerait avec votre repas !',
                expert: {
                    title: 'Physiologie Gastrique',
                    content: 'Les <strong>Cellules Pari√©tales</strong> s√©cr√®tent du HCl et du Facteur Intrins√®que (vital pour absorber la vitamine B12). Les <strong>Cellules Principales</strong> s√©cr√®tent du Pepsinog√®ne, qui est inactif. Ce n\'est qu\'au contact de l\'acide qu\'il se transforme en Pepsine active.',
                    quiz: {
                        q: "Pourquoi le pepsinog√®ne est-il s√©cr√©t√© sous forme inactive ?",
                        opts: ["Pour √©conomiser de l'√©nergie", "Pour ne pas dig√©rer la propre cellule", "Parce que l'acide le d√©truit"],
                        a: 1
                    }
                },
                details: {
                    glandulas: 'Glandes Gastriques',
                    sustancias: 'Suc Gastrique (Acide Chlorhydrique + Pepsine)',
                    enzimas: 'Pepsine',
                    sustrato: 'Prot√©ines',
                    molecula: 'Cha√Ænes plus courtes (Acides amin√©s / Peptides)',
                    producto: 'CHYME (Bouillie acide)'
                },
                content: `
                    <p>Un sac musculaire avec un environnement extr√™me. Il s'y passe :</p>
                    <ul>
                        <li><strong>Attaque Chimique (Acidit√©) :</strong> L'Acide Chlorhydrique (HCl) a un pH de 1,5. Le jus de citron a un pH de 2,5. Comme l'√©chelle est logarithmique, votre estomac est <strong>10 fois plus acide</strong> que le citron pur ! Cela tue les bact√©ries et d√©nature les prot√©ines.</li>
                        <li><strong>Digestion Enzymatique :</strong> La <strong>Pepsine</strong> coupe les prot√©ines en cha√Ænes plus courtes (peptides).</li>
                        <li><strong>Protection :</strong> Les parois s√©cr√®tent du mucus pour ne pas s'autodig√©rer.</li>
                    </ul>
                `,
                quiz: {
                    question: "L'estomac est tr√®s acide. Quelle est la fonction principale de cet acide ?",
                    options: [
                        { text: "Dig√©rer les sucres", correct: false, feedback: "Les sucres sont dig√©r√©s principalement dans la bouche et l'intestin." },
                        { text: "√âmulsionner les graisses", correct: false, feedback: "C'est la bile qui fait √ßa dans le duod√©num." },
                        { text: "D√©naturer les prot√©ines et d√©sinfecter", correct: true, feedback: "Correct ! Il pr√©pare les prot√©ines pour la pepsine et tue les agents pathog√®nes." }
                    ]
                }
            },
            {
                id: 'duodeno',
                title: '4. Duod√©num : Digestion Finale',
                subtitle: 'Foie et Pancr√©as en action',
                imgUrl: GALERIA_IMAGENES.DUODENO,
                icon: '‚ö°',
                processes: [
                    { type: 'chemical', text: '√âmulsion (Bile)', desc: 'Brise les grosses gouttes de graisse en microgouttelettes.' },
                    { type: 'chemical', text: 'Neutralisation', desc: 'Le bicarbonate pancr√©atique annule l\'acide de l\'estomac.' }
                ],
                pathology: {
                    name: 'Calculs Biliaires',
                    desc: 'Pierres form√©es dans la v√©sicule biliaire. Elles peuvent bloquer la sortie de la bile, emp√™chant la bonne digestion des graisses.'
                },
                curiosity: 'L\'intestin gr√™le mesure entre 6 et 7 m√®tres de long. C\'est plus long qu\'une grande camionnette mise √† la verticale !',
                expert: {
                    title: 'R√©gulation Hormonale',
                    content: 'Le canal chol√©doque (bile) et le canal de Wirsung (pancr√©as) se rejoignent et d√©bouchent ensemble dans le duod√©num par l\'<strong>Ampoule de Vater</strong>. Ceci est r√©gul√© par des hormones comme la CCK et la S√©cr√©tine.',
                    quiz: {
                        q: "O√π d√©bouchent finalement la bile et le suc pancr√©atique ?",
                        opts: ["Dans le Pylore", "Dans l'Ampoule de Vater", "Dans le C√¶cum"],
                        a: 1
                    }
                },
                details: {
                    glandulas: 'Foie et Pancr√©as',
                    sustancias: 'Bile et Suc Pancr√©atique',
                    enzimas: 'Lipase, Amylase, Tripsine',
                    sustrato: 'Graisses, Glucides, Prot√©ines',
                    molecula: 'Acides gras, Glucose, Acides amin√©s',
                    producto: 'CHYLE (Liquide laiteux)'
                },
                content: `
                    <p>Le "laboratoire chimique" du corps. Deux organes vitaux y d√©versent leurs s√©cr√©tions :</p>
                    <ul>
                        <li><strong>Foie (Bile) :</strong> Ne contient pas d'enzymes. Agit comme un d√©tergent (√©mulsion) brisant les graisses en minuscules gouttelettes pour que les enzymes puissent mieux les attaquer.</li>
                        <li><strong>Pancr√©as :</strong> S√©cr√®te du bicarbonate (neutralise l'acide du chyme) et des enzymes puissantes : <strong>Lipase</strong> (graisses), <strong>Tripsine</strong> (prot√©ines) et <strong>Amylase</strong>.</li>
                    </ul>
                `,
                quiz: {
                    question: "Si on enl√®ve la v√©sicule biliaire √† une personne, quel aliment doit-elle mod√©rer ?",
                    options: [
                        { text: "Alimentos gras", correct: true, feedback: "Bien pens√© ! Sans r√©serve de bile, il est plus difficile de dig√©rer beaucoup de graisses d'un coup." },
                        { text: "Sucres", correct: false, feedback: "La bile n'intervient pas dans la digestion des sucres." },
                        { text: "L√©gumes", correct: false, feedback: "Les l√©gumes se dig√®rent bien sans bile." }
                    ]
                }
            },
            {
                id: 'yeyuno',
                title: '5. J√©junum et Il√©on : Absorption',
                subtitle: 'Passage dans le sang',
                imgUrl: GALERIA_IMAGENES.INTESTINO_DELGADO,
                icon: '‚ö°',
                processes: [
                    { type: 'mechanical', text: 'Diffusion et Transport', desc: 'Passage √† travers les membranes cellulaires.' }
                ],
                pathology: {
                    name: 'Maladie C≈ìliaque',
                    desc: 'R√©action immunitaire au gluten qui endommage les villosit√©s intestinales. En "s\'aplatissant", les villosit√©s perdent de la surface d\'absorption et il y a malnutrition.'
                },
                curiosity: 'Si vous √©tiriez toutes les villosit√©s et microvillosit√©s de votre intestin, elles couvriraient une surface de 300 m√®tres carr√©s. C\'est aussi grand qu\'un terrain de tennis !',
                expert: {
                    title: 'Transport des Nutriments',
                    content: 'Le glucose et les acides amin√©s vont dans le sang et voyagent directement vers le foie par la <strong>Veine Porte</strong>. Les graisses, √©tant de grosses mol√©cules, entrent dans les vaisseaux chylif√®res (lymphe) et √©vitent le foie initialement.',
                    quiz: {
                        q: "Vers quel organe vont d'abord les nutriments absorb√©s dans le sang ?",
                        opts: ["Vers le C≈ìur", "Vers le Foie", "Vers les Reins"],
                        a: 1
                    }
                },
                details: {
                    glandulas: 'Glandes Intestinales',
                    sustancias: 'Suc Intestinal',
                    enzimas: 'Peptidases, Disaccharidases',
                    sustrato: 'Restes de nutriments',
                    molecula: 'Nutriments √©l√©mentaires',
                    producto: 'Nutriments dans le Sang/Lymphe'
                },
                content: `
                    <p>6-7 m√®tres de tube sp√©cialis√© dans la capture des nutriments. Son secret est la <strong>Surface</strong> :</p>
                    <ul>
                        <li><strong>Plis et Villosit√©s :</strong> La paroi interne n'est pas lisse, elle a des millions de "doigts" microscopiques. Cela multiplie la surface d'absorption.</li>
                        <li><strong>Destination :</strong> Le glucose et les acides amin√©s vont dans le <strong>sang</strong>. Les graisses vont dans le syst√®me <strong>lymphatique</strong>.</li>
                    </ul>
                    <p><strong>Voici √† quoi elles ressemblent de l'int√©rieur (Ensemble et D√©tail) :</strong></p>
                    <img src="${GALERIA_IMAGENES.VELLOSIDADES}" alt="Ensemble de villosit√©s" />
                    <img src="${GALERIA_IMAGENES.VELLOSIDAD_DETALLE}" alt="D√©tail d'une villosit√©" />
                `,
                quiz: {
                    question: "√Ä quoi servent les villosit√©s intestinales ?",
                    options: [
                        { text: "√Ä d√©placer la nourriture", correct: false, feedback: "Le mouvement est fait par le muscle (p√©ristaltisme)." },
                        { text: "Augmenter la surface d'absorption", correct: true, feedback: "Exact ! Plus de surface signifie capturer plus de nutriments." },
                        { text: "Filtrer les toxines", correct: false, feedback: "Le filtrage principal est fait par le foie et les reins." }
                    ]
                }
            },
            {
                id: 'colon',
                title: '6. Gros Intestin : R√©sidus',
                subtitle: 'Eau et Microbiote',
                imgUrl: GALERIA_IMAGENES.INTESTINO_GRUESO,
                icon: 'üí©',
                processes: [
                    { type: 'mechanical', text: 'R√©absorption', desc: 'R√©cup√©ration d\'eau et de sels.' },
                    { type: 'chemical', text: 'Fermentation', desc: 'Action bact√©rienne sur les fibres.' }
                ],
                pathology: {
                    name: 'Appendicite',
                    desc: 'Inflammation de l\'appendice (au d√©but du c√¥lon). S\'il se bloque et s\'infecte, il peut √©clater (p√©ritonite), √©tant une urgence m√©dicale.'
                },
                curiosity: 'Vous transportez des passagers ! Vous avez entre 1,5 et 2 kg de bact√©ries vivant dans votre intestin. Elles p√®sent presque autant que votre cerveau.',
                expert: {
                    title: 'Symbiose et Vitamines',
                    content: 'Notre relation avec le microbiote est une symbiose : nous leur donnons le g√Æte et le couvert (fibres), et elles nous donnent des vitamines. La <strong>Vitamine K</strong> produite ici est essentielle pour la coagulation du sang.',
                    quiz: {
                        q: "Quelle vitamine essentielle produit notre flore intestinale ?",
                        opts: ["Vitamine C", "Vitamine D", "Vitamine K"],
                        a: 2
                    }
                },
                details: {
                    glandulas: '(Microbiote bact√©rien)',
                    sustancias: '-',
                    enzimas: 'Fermentation bact√©rienne',
                    sustrato: 'Restes non dig√©r√©s (Cellulose/Fibres)',
                    molecula: 'Vitamines (K et B), Gaz',
                    producto: 'MATI√àRES F√âCALES'
                },
                content: `
                    <p>Ici arrivent les restes non digestibles (principalement des fibres v√©g√©tales). Fonctions finales :</p>
                    <ul>
                        <li><strong>Derni√®re Digestion :</strong> Le <strong>Microbiote</strong> (bonnes bact√©ries) fermente les fibres et produit des vitamines (K, B12) que nous absorbons ensuite.</li>
                        <li><strong>R√©cup√©rer l'Eau :</strong> Convertit les r√©sidus liquides en solides (selles). Si cela √©choue, nous avons la diarrh√©e.</li>
                        <li><strong>D√©f√©cation :</strong> Accumulation dans le rectum et expulsion par l'anus.</li>
                    </ul>
                    <p><strong>Notre Flore Intestinale :</strong></p>
                    <img src="${GALERIA_IMAGENES.FLORA_INTESTINAL}" alt="Flore intestinale" />
                `,
                quiz: {
                    question: "Quel r√¥le crucial jouent nos bact√©ries intestinales ?",
                    options: [
                        { text: "Aucun, ce sont des parasites", correct: false, feedback: "Faux ! Elles sont vitales pour notre sant√©." },
                        { text: "Dig√©rer les prot√©ines", correct: false, feedback: "Les prot√©ines sont dig√©r√©es avant." },
                        { text: "Produire des vitamines et prot√©ger", correct: true, feedback: "Correct ! Elles nous donnent des vitamines et emp√™chent la croissance des mauvaises bact√©ries." }
                    ]
                }
            }
        ];

        // --- COMPONENTES ---

        const BackgroundBubbles = () => {
            const bubbles = Array.from({ length: 20 }).map((_, i) => ({
                id: i,
                left: `${Math.random() * 100}%`,
                size: `${Math.random() * 60 + 20}px`,
                duration: `${Math.random() * 10 + 15}s`,
                delay: `${Math.random() * 5}s`,
                color: ['bubble-red', 'bubble-pink', 'bubble-brown', 'bubble-orange'][Math.floor(Math.random() * 4)]
            }));
            return (
                <div className="bubbles">
                    {bubbles.map(b => (
                        <div key={b.id} className={`bubble ${b.color}`} style={{ left: b.left, width: b.size, height: b.size, animationDuration: b.duration, animationDelay: b.delay }} />
                    ))}
                </div>
            );
        };

        const ImageModal = ({ src, alt, onClose }) => (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 modal-enter" onClick={onClose}>
                <div className="relative max-w-7xl max-h-screen w-full h-full flex items-center justify-center">
                    <img src={src} alt={alt} className="max-w-full max-h-full object-contain rounded-lg shadow-2xl" />
                    <button onClick={onClose} className="absolute top-4 right-4 text-white bg-white/10 hover:bg-white/20 p-2 rounded-full backdrop-blur-md transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>
                    </button>
                </div>
            </div>
        );

        const ProcessBadge = ({ type, text, desc }) => {
            const [showTooltip, setShowTooltip] = useState(false);
            return (
                <div className="relative inline-block m-1">
                    <button onClick={() => setShowTooltip(!showTooltip)} className={`flex items-center gap-1.5 px-4 py-2 rounded-full text-xs font-bold border-2 transition-all shadow-sm hover:scale-105 active:scale-95 ${type === 'mechanical' ? 'bg-orange-100 text-orange-800 border-orange-300' : 'bg-blue-100 text-blue-800 border-blue-300'}`}>
                        {type === 'mechanical' ? <Settings size={14}/> : <FlaskConical size={14}/>}
                        <span>{text}</span>
                        <Info size={12} className="opacity-50 ml-1"/>
                    </button>
                    {showTooltip && (
                        <div className="absolute bottom-full left-1/2 mb-2 w-64 -translate-x-1/2 bg-slate-800 text-white text-sm p-4 rounded-2xl shadow-xl z-50 text-center tooltip-enter">
                            <p>{desc}</p>
                            <div className="absolute top-full left-1/2 -translate-x-1/2 border-8 border-transparent border-t-slate-800"></div>
                        </div>
                    )}
                    {showTooltip && <div className="fixed inset-0 z-40" onClick={() => setShowTooltip(false)}></div>}
                </div>
            );
        };

        const QuizModal = ({ quiz, onComplete, onClose }) => {
            const [selected, setSelected] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const [isCorrect, setIsCorrect] = useState(false);

            const handleCheck = (option, index) => {
                setSelected(index);
                setFeedback(option.feedback);
                setIsCorrect(option.correct);
                if (option.correct) {
                    onComplete(); 
                }
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden border-4 border-white/50">
                        <div className="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-5 flex justify-between items-center">
                            <h3 className="font-black text-lg flex items-center gap-2"><Lock size={20} className="text-orange-400"/> Checkpoint</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white bg-white/10 p-2 rounded-full">‚úï</button>
                        </div>
                        <div className="p-6 md:p-8 bg-slate-50">
                            <p className="text-xl font-bold text-slate-800 mb-6 leading-snug">{quiz.question}</p>
                            <div className="space-y-3">
                                {quiz.options.map((opt, i) => (
                                    <button
                                        key={i}
                                        onClick={() => !isCorrect && handleCheck(opt, i)}
                                        className={`w-full text-left p-4 rounded-xl border-2 font-bold transition-all transform ${
                                            selected === i 
                                            ? (opt.correct ? 'border-emerald-500 bg-emerald-100 text-emerald-800 scale-105' : 'border-rose-500 bg-rose-100 text-rose-800 shake')
                                            : 'border-slate-200 bg-white hover:border-orange-300 hover:bg-orange-50 text-slate-600'
                                        }`}
                                    >
                                        {opt.text}
                                    </button>
                                ))}
                            </div>
                            {feedback && (
                                <div className={`mt-6 p-4 rounded-2xl text-sm font-bold text-center animate-bounce shadow-lg ${isCorrect ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`}>
                                    {feedback}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const Card = ({ step, index, isLocked, onUnlock, isLast, onImageClick, onAddPoints }) => {
            const [open, setOpen] = useState(false);
            const [showCuriosity, setShowCuriosity] = useState(false);
            const [showExpert, setShowExpert] = useState(false);
            const [showQuiz, setShowQuiz] = useState(false);
            
            // Estado para evitar farmear puntos
            const [pointsAwarded, setPointsAwarded] = useState({ curiosity: false, expertQuiz: false });
            // Estado de completado del test experto
            const [expertQuizStatus, setExpertQuizStatus] = useState('pending'); // pending, correct, failed

            const handleContentClick = (e) => {
                if (e.target.tagName === 'IMG') {
                    onImageClick(e.target.src, e.target.alt);
                }
            };

            const handleCuriosity = () => {
                if (!showCuriosity && !pointsAwarded.curiosity) {
                    onAddPoints(5);
                    setPointsAwarded(prev => ({...prev, curiosity: true}));
                }
                setShowCuriosity(!showCuriosity);
            };

            const handleExpert = () => {
                setShowExpert(!showExpert);
            };

            const handleExpertQuiz = (isCorrectAnswer) => {
                if (isCorrectAnswer) {
                    setExpertQuizStatus('correct');
                    if (!pointsAwarded.expertQuiz) {
                        onAddPoints(10);
                        setPointsAwarded(prev => ({...prev, expertQuiz: true}));
                    }
                } else {
                    setExpertQuizStatus('failed');
                }
            };

            if (isLocked) {
                return (
                    <div className="mb-12 relative pl-8 md:pl-12 locked-card">
                        <div className="absolute left-[-8px] top-8 w-4 h-4 rounded-full bg-slate-300 border-4 border-white z-10"></div>
                        <div className="bg-white/50 rounded-3xl border border-white p-8 flex flex-col items-center justify-center text-center shadow-none">
                            <div className="bg-slate-200 p-4 rounded-full mb-4"><Lock className="text-slate-400" size={32}/></div>
                            <h3 className="font-bold text-slate-400 text-xl">√âtape Verrouill√©e</h3>
                        </div>
                    </div>
                );
            }

            return (
                <div id={`card-${index}`} className="mb-16 relative pl-8 md:pl-12 group card-enter" style={{animationDelay: '0.1s'}}>
                    <div className="absolute left-[-20px] top-6 w-10 h-10 rounded-full bg-white border-4 border-orange-200 z-10 shadow-lg flex items-center justify-center text-xl transform transition-transform hover:scale-125 cursor-pointer">
                        {step.icon}
                    </div>

                    <div className="bg-white rounded-3xl shadow-xl shadow-orange-100/50 border border-white overflow-hidden hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-1">
                        <div className="flex flex-col md:flex-row">
                            <div className="md:w-1/2 relative h-64 md:h-auto bg-orange-50 overflow-hidden cursor-zoom-in group-image" onClick={() => onImageClick(step.imgUrl, step.title)}>
                                <img src={step.imgUrl} alt={step.title} className="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110" />
                                <div className="absolute top-4 right-4 bg-black/50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                                </div>
                            </div>
                            
                            <div className="md:w-1/2 p-6 md:p-8 flex flex-col justify-center">
                                <div className="hidden md:block mb-4">
                                    <h3 className="text-xs font-black text-orange-500 uppercase tracking-widest mb-1">{step.title}</h3>
                                    <h2 className="text-3xl font-black text-slate-800 leading-tight">{step.subtitle}</h2>
                                </div>
                                <div className="flex flex-wrap mb-6 gap-2">{step.processes.map((p, i) => <ProcessBadge key={i} {...p} />)}</div>
                                
                                <div className="bg-rose-50 p-5 rounded-2xl border border-rose-100 mb-4 flex gap-4 items-start shadow-sm">
                                    <div className="bg-white p-2 rounded-full shadow-sm text-rose-500 shrink-0"><Stethoscope size={20}/></div>
                                    <div>
                                        <h4 className="text-xs font-black text-rose-400 uppercase mb-1">Consultation M√©dicale : {step.pathology.name}</h4>
                                        <p className="text-sm font-bold text-slate-700 leading-snug">{step.pathology.desc}</p>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <div className="relative">
                                        <button onClick={handleCuriosity} className="w-full flex items-center gap-2 bg-amber-100 hover:bg-amber-200 text-amber-800 px-4 py-3 rounded-xl text-sm font-bold transition-all">
                                            <Bulb size={18}/> <span>üí° Le Saviez-vous ? (Curiosit√©)</span>
                                            {showCuriosity ? <ChevronUp size={16} className="ml-auto"/> : <ChevronDown size={16} className="ml-auto"/>}
                                        </button>
                                        {showCuriosity && <div className="mt-2 p-4 bg-amber-50 border-2 border-amber-100 rounded-xl text-sm text-amber-900 font-medium animate-fade-in shadow-inner">{step.curiosity}</div>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="border-t border-slate-100">
                            <button onClick={() => setOpen(!open)} className="w-full flex justify-between items-center p-4 px-8 text-slate-500 hover:text-orange-600 hover:bg-orange-50 transition-colors font-bold text-sm uppercase tracking-wide group-btn">
                                <span>Ver explication scientifique</span>
                                {open ? <ChevronUp className="text-orange-400"/> : <ChevronDown className="group-btn-hover:translate-y-1 transition-transform"/>}
                            </button>
                            {open && (
                                <div className="p-8 bg-orange-50/50 text-slate-700 leading-relaxed text-lg border-t border-orange-100 animate-fade-in content-html" onClick={handleContentClick}>
                                    <div className="bg-white p-6 rounded-2xl border border-orange-100 shadow-sm mb-6">
                                        <h3 className="text-sm font-black text-orange-500 uppercase tracking-wider mb-4 border-b border-orange-100 pb-2 flex items-center gap-2">
                                            <Activity size={16}/> üî¨ Analyse D√©taill√©e du Processus
                                        </h3>
                                        <ul className="text-sm space-y-2 m-0 p-0 list-none">
                                            <li><strong className="text-slate-900">Glandes :</strong> {step.details.glandulas}</li>
                                            <li><strong className="text-slate-900">Substances :</strong> {step.details.sustancias}</li>
                                            <li><strong className="text-slate-900">Enzymes :</strong> {step.details.enzimas}</li>
                                            <li><strong className="text-slate-900">Agit sur :</strong> {step.details.sustrato}</li>
                                            <li><strong className="text-slate-900">Mol√©cule :</strong> {step.details.molecula}</li>
                                            <li className="mt-2 pt-2 border-t border-orange-100 flex justify-between items-center">
                                                <strong className="text-slate-900">Produit Final :</strong> 
                                                <span className="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full font-black text-xs uppercase tracking-wide">{step.details.producto}</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div dangerouslySetInnerHTML={{__html: step.content}}></div>

                                    {/* NIVEL EXPERTO MOVIDO AQU√ç */}
                                    <div className="mt-8 relative border-t-2 border-purple-100 pt-6">
                                        <button onClick={handleExpert} className="w-full flex items-center gap-2 bg-purple-100 hover:bg-purple-200 text-purple-900 px-4 py-3 rounded-xl text-sm font-bold transition-all">
                                            <GraduationCap size={18}/> <span>üéì Niveau Expert (Avanc√©)</span>
                                            {showExpert ? <ChevronUp size={16} className="ml-auto"/> : <ChevronDown size={16} className="ml-auto"/>}
                                        </button>
                                        {showExpert && (
                                            <div className="mt-2 p-5 bg-purple-50 border-2 border-purple-100 rounded-xl text-sm text-purple-900 animate-fade-in shadow-inner">
                                                <h4 className="font-black text-purple-700 mb-2 uppercase text-xs tracking-wider">{step.expert.title}</h4>
                                                <p className="mb-4" dangerouslySetInnerHTML={{__html: step.expert.content}}></p>
                                                
                                                {/* Mini Quiz Experto L√≥gica Muerte S√∫bita */}
                                                {expertQuizStatus === 'pending' && (
                                                    <div className="bg-white p-4 rounded-lg border border-purple-200 shadow-sm">
                                                        <p className="font-bold text-slate-800 mb-2">üß† D√©fi Expert : {step.expert.quiz.q}</p>
                                                        <div className="space-y-2">
                                                            {step.expert.quiz.opts.map((opt, i) => (
                                                                <button key={i} 
                                                                    onClick={() => handleExpertQuiz(i === step.expert.quiz.a)}
                                                                    className="w-full text-left p-2 rounded bg-purple-50 hover:bg-purple-100 text-xs font-bold transition-colors">
                                                                    {opt}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                {expertQuizStatus === 'correct' && (
                                                    <div className="bg-green-100 text-green-800 p-3 rounded-lg font-bold text-center text-xs flex flex-col items-center justify-center gap-2 animate-fade-in">
                                                        <div className="flex items-center gap-2">
                                                            <CheckCircle size={18}/> Correct ! +10 Points
                                                        </div>
                                                        <p className="text-green-700 font-normal">R√©ponse correcte. Continuez comme √ßa !</p>
                                                        <button 
                                                            onClick={() => setShowExpert(false)}
                                                            className="mt-2 text-green-700 underline hover:text-green-900"
                                                        >
                                                            Fermer la section expert
                                                        </button>
                                                    </div>
                                                )}

                                                {expertQuizStatus === 'failed' && (
                                                    <div className="bg-rose-100 text-rose-800 p-3 rounded-lg font-bold text-center text-xs flex flex-col items-center justify-center gap-2 animate-fade-in">
                                                        <div className="flex items-center gap-2">
                                                            <XCircle size={18}/> Mauvaise R√©ponse
                                                        </div>
                                                        <p className="text-rose-700 font-normal">R√©essayez la prochaine fois.</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Bot√≥n de desbloqueo/finalizaci√≥n siempre visible, cambia seg√∫n isLast */}
                        <div className="p-4 bg-white border-t border-slate-100 flex justify-center md:justify-end">
                            <button 
                                onClick={() => setShowQuiz(true)}
                                className={`w-full md:w-auto text-white px-8 py-4 rounded-2xl font-black text-lg flex items-center justify-center gap-3 transition-all shadow-xl hover:-translate-y-1 ${
                                    isLast 
                                    ? "bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 shadow-emerald-500/30" 
                                    : "bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-600 hover:to-rose-600 shadow-orange-500/30"
                                }`}
                            >
                                {isLast ? (
                                    <> <Flag size={20}/> Terminer le Parcours üèÅ <CheckCircle size={20}/> </>
                                ) : (
                                    <> <Unlock size={20}/> Terminer l'√âtape et Continuer <ArrowRight size={20}/> </>
                                )}
                            </button>
                        </div>
                    </div>
                    
                    {showQuiz && (
                        <QuizModal 
                            quiz={step.quiz} 
                            onClose={() => setShowQuiz(false)} 
                            onComplete={() => {
                                onAddPoints(10);
                                setTimeout(() => {
                                    setShowQuiz(false);
                                    onUnlock();
                                }, 1500); 
                            }} 
                        />
                    )}
                </div>
            );
        };

        const App = () => {
            const [unlockedStep, setUnlockedStep] = useState(0);
            const [modalImage, setModalImage] = useState(null);
            const [score, setScore] = useState(0);
            const [pointsAnim, setPointsAnim] = useState(null);

            const handleUnlock = (index) => {
                const nextStep = index + 1;
                setUnlockedStep(nextStep);
                if (nextStep < STEPS.length) {
                    setTimeout(() => {
                        document.getElementById(`card-${nextStep}`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                } else {
                    setTimeout(() => {
                        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                    }, 300);
                }
            };

            const addPoints = (amount) => {
                setScore(prev => prev + amount);
                setPointsAnim(amount);
                setTimeout(() => setPointsAnim(null), 2000);
            };

            const getRank = () => {
                if (score < 50) return "Novice Digestif";
                if (score < 100) return "Expert en Nutrition";
                return "Ma√Ætre du M√©tabolisme";
            };

            return (
                <div className="min-h-screen pb-20 relative">
                    <BackgroundBubbles />
                    {modalImage && <ImageModal src={modalImage.src} alt={modalImage.alt} onClose={() => setModalImage(null)} />}
                    {pointsAnim && <div className="floating-points">+{pointsAnim}</div>}

                    <div className="bg-white/90 backdrop-blur-md text-slate-800 py-4 px-4 mb-10 sticky top-0 z-40 shadow-sm border-b border-orange-100">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-orange-500 rounded-xl flex items-center justify-center text-white shadow-lg">
                                    <Activity size={24}/>
                                </div>
                                <div>
                                    <span className="text-orange-500 font-black tracking-widest text-[10px] uppercase block mb-0.5">UT2.2</span>
                                    <h1 className="text-lg md:text-xl font-black leading-none">Les Chroniques des Nutriments</h1>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="relative bg-slate-900 text-white px-4 py-2 rounded-full font-black flex items-center gap-2 shadow-lg">
                                    <Medal size={18} className="text-yellow-400"/>
                                    <span>{score} pts</span>
                                </div>
                            </div>
                        </div>
                        {/* Progress Bar */}
                        <div className="absolute bottom-0 left-0 w-full h-1 bg-slate-100">
                            <div className="h-full bg-gradient-to-r from-orange-400 to-rose-500 transition-all duration-1000" style={{width: `${((unlockedStep + 1) / STEPS.length) * 100}%`}}></div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 md:px-8">
                        <div className="flex">
                            <div className="relative mr-6 md:mr-10 shrink-0 hidden md:block">
                                <div className="absolute left-[9px] top-6 bottom-0 w-1 bg-orange-100 rounded-full"></div>
                                <div className="absolute left-[9px] top-6 w-1 bg-gradient-to-b from-orange-400 to-rose-600 rounded-full transition-all duration-1000" style={{height: `${(unlockedStep / (STEPS.length - 1)) * 100}%`}}></div>
                            </div>
                            <div className="flex-1">
                                {STEPS.map((step, index) => (
                                    <Card 
                                        key={step.id} 
                                        step={step} 
                                        index={index} 
                                        isLocked={index > unlockedStep} 
                                        onUnlock={() => handleUnlock(index)}
                                        isLast={index === STEPS.length - 1}
                                        onImageClick={(src, alt) => setModalImage({src, alt})}
                                        onAddPoints={addPoints}
                                    />
                                ))}
                            </div>
                        </div>
                        
                        {unlockedStep === STEPS.length && (
                            <div className="mt-16 animate-fade-in">
                                <div className="text-center py-12 pl-8 mb-12 bg-white rounded-3xl shadow-xl border-4 border-orange-100 mx-4">
                                    <div className="inline-block p-6 rounded-full bg-emerald-100 text-emerald-600 mb-6 animate-bounce shadow-lg">
                                        <Award size={64}/>
                                    </div>
                                    <h3 className="text-4xl font-black text-slate-800 mb-2">Mission Accomplie !</h3>
                                    <p className="text-slate-500 font-bold text-lg mb-6">Vous avez termin√© le voyage √† travers le syst√®me digestif.</p>
                                    <div className="inline-block bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-xl">
                                        <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Score Final</div>
                                        <div className="text-5xl font-black text-yellow-400 mb-2">{score} pts</div>
                                        <div className="text-emerald-400 font-bold text-lg">{getRank()}</div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-3xl shadow-xl border border-white overflow-hidden mx-4">
                                    <div className="bg-slate-900 text-white p-6 flex items-center gap-3">
                                        <div className="bg-orange-500 p-2 rounded-lg"><Activity size={24}/></div>
                                        <h3 className="font-black text-xl">Tableau Ma√Ætre des Processus</h3>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left">
                                            <thead className="text-xs text-slate-400 uppercase bg-slate-50 border-b font-bold tracking-wider">
                                                <tr><th className="px-6 py-4">Organe</th><th className="px-6 py-4">Suc/S√©cr√©tion</th><th className="px-6 py-4">Enzyme</th><th className="px-6 py-4">Agit sur...</th><th className="px-6 py-4">R√©sultat</th><th className="px-6 py-4 text-emerald-600">Produit Final</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100 text-sm font-medium">
                                                <tr className="hover:bg-orange-50/50"><td className="px-6 py-4 font-bold text-slate-800">Bouche</td><td>Saliva</td><td className="italic text-orange-600">Amylase</td><td>Amidon (Glucides)</td><td>Sucres simples</td><td className="text-emerald-600 font-bold bg-emerald-50 rounded-lg px-2">Bol Alimentaire</td></tr>
                                                <tr className="hover:bg-orange-50/50"><td className="px-6 py-4 font-bold text-slate-800">Estomac</td><td>Suc Gastrique</td><td className="italic text-orange-600">Pepsine (+HCl)</td><td>Prot√©ines</td><td>Peptides</td><td className="text-emerald-600 font-bold bg-emerald-50 rounded-lg px-2">Chyme</td></tr>
                                                <tr className="hover:bg-orange-50/50"><td className="px-6 py-4 font-bold text-slate-800">Foie*</td><td>Bile</td><td className="italic text-slate-400">Sans enzymes</td><td>Graisses (Lipides)</td><td>√âmulsion</td><td className="text-emerald-600 font-bold bg-emerald-50 rounded-lg px-2">Chyle</td></tr>
                                                <tr className="hover:bg-orange-50/50"><td className="px-6 py-4 font-bold text-slate-800">Pancr√©as*</td><td>Suc Pancr√©atique</td><td className="italic text-orange-600">Lipasa, Tripsina...</td><td>Graisses, Prot√©ines...</td><td>Nutriments</td><td className="text-emerald-600 font-bold bg-emerald-50 rounded-lg px-2">Chyle</td></tr>
                                                <tr className="hover:bg-orange-50/50"><td className="px-6 py-4 font-bold text-slate-800">Intestin</td><td>Suc Intestinal</td><td className="italic text-orange-600">Peptidases...</td><td>Peptides</td><td>Acides Amin√©s</td><td className="text-emerald-600 font-bold bg-emerald-50 rounded-lg px-2">Nutriments/Selles</td></tr>
                                            </tbody>
                                        </table>
                                        <div className="px-6 py-4 text-xs text-slate-400 bg-slate-50 italic font-bold text-right border-t">* Se d√©versent dans le Duod√©num</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
